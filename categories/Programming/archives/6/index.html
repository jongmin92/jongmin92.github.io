<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="naver-site-verification" content="427d651b8544d9dd05f3baf8b71682504788ae7e"><title>카테고리: Programming - 92Hz</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="92Hz"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="92Hz"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="website"><meta property="og:title" content="92Hz"><meta property="og:url" content="https://jongmin92.github.io/"><meta property="og:site_name" content="92Hz"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://jongmin92.github.io/img/og_image.png"><meta property="article:author" content="KimJongMin"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jongmin92.github.io"},"headline":"92Hz","image":["https://jongmin92.github.io/img/og_image.png"],"author":{"@type":"Person","name":"KimJongMin"},"description":""}</script><link rel="alternate" href="/rss2.xml" title="92Hz" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-90389042-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-90389042-1');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-3921438651818825" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="92Hz" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="external nofollow noopener noreferrer" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">카테고리</a></li><li class="is-active"><a href="#" aria-current="page">Programming</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-02-11T09:30:00.000Z" title="2/11/2018, 6:30:00 PM">2018-02-11</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:08:07.635Z" title="3/21/2021, 8:08:07 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a><span> / </span><a class="link-muted" href="/categories/Programming/Spring/">Spring</a></span><span class="level-item">27분안에 읽기 (약 4065 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/02/11/Spring/spring-ioc-di/">Spring - IoC &amp; DI</a></h1><div class="content"><h1 id="IoC란"><a href="#IoC란" class="headerlink" title="IoC란?"></a>IoC란?</h1><p>IoC 컨테이너 개념을 이해하기 위하여 이와 같은 컨테이너가 왜 등장하게 되었는지를 먼저 이해하는 것이 중요합니다.</p>
<p>애플리케이션 코드를 작성할 때, 특정 기능이 필요하면 라이브러리 사용하곤 합니다. 이때는 프로그램의 흐름을 제어하는 주체가 애플리케이션 코드입니다. 하지만 <strong>프레임워크(Framework) 기반의 개발에서는 프레임워크 자신이 흐름을 제어하는 주체가 되어, 필요 할 때마다 애플리케이션 코드를 호출하여 사용합니다.</strong></p>
<p>프레임워크에서 이 제어권을 가지는 것이 바로 <code>컨테이너(Container)</code>입니다. <strong>객체에 대한 제어권이 개발자로부터 컨테이너에게 넘어가면서 객체의 생성부터 생명주기 관리까지의 모든 것을 컨테이너가 맡아서 하게됩니다.</strong> 이를 <strong>일반적인 제어권의 흐름이 바뀌었다고 하여 <code>IoC(Inversion of Control : 제어의 역전)</code>라고 합니다.</strong></p>
<p>먼저 지금까지 일반적으로 개발하던 방식에 대해서 생각해보아야 합니다. 모든 인스턴스에 대한 생성 권한은 지금까지 모든 개발자들에게 있었습니다. 즉, 작성하는 코드상에서 개발자가 직접 생성했다는 것입니다. EJB나 IoC 컨테이너를 사용하지 않았던 개발자들은 지금까지 이와 같은 방식을 사용했습니다.</p>
<p>EJB는 각 개발자들이 모든 인스턴스의 생성 권한에 제약을 가하는 첫번째 프레임워크입니다. EJB는 서비스를 위해 생성되는 컴포넌트에 대한 생성 권한을 EJB 컨테이너에게 위임했습니다. 생성된 인스턴스는 EJB 컨테이너가 생명주기를 관리했습니다. EJB가 EJB 컨테이너에 의하여 관리됨으로 인해 큰 장점을 얻을 수 있었습니다. 그러나 장점 이외에 EJB가 가지고 있는 한계에 부딪히게 되었으며, 이 같은 요구사항을 해결하기 위해 EJB의 한계를 극복하기 위한 시도가 발생했습니다.</p>
<p>그래서 등장한 것이 경량(LightWeight) IoC 컨테이너 입니다. 경량 IoC 컨테이너는 EJB 컨테이너가 가지고 있던 단점을 보완하기 위하여 탄생한 컨테이너 개념입니다. <strong>Spring 프레임워크에서 지원하는 IoC 컨테이너는 우리들이 흔히 개발하고 사용해왔던 일반 <code>POJO(Plain Old Java Object)</code> 클래스들이 지금까지 EJB를 통하여 실행했던 많은 기능들을 서비스 가능하도록 지원합니다.</strong><br>또한, EJB 컨테이너가 지원하고 있던 Transaction, Object Pooling, 인스턴스 생명주기 관리등의 기능들을 Spring 컨테이너가 지원하며 부가적으로 테스트의 용이성(애플리케이션 품질의 향상), 개발 생산성을 향상 시킬 수 있습니다.</p>
<h1 id="사용하는-목적"><a href="#사용하는-목적" class="headerlink" title="사용하는 목적"></a>사용하는 목적</h1><p>IoC를 사용하는 목적에 대해서는 지금까지의 클래스호출 방식의 변화를 살펴보면 더 쉽게 이해할 수 있습니다.</p>
<h2 id="클래스-호출-방식"><a href="#클래스-호출-방식" class="headerlink" title="클래스 호출 방식"></a>클래스 호출 방식</h2><p>클래스내에 선언과 구현이 같이 있기 때문에 다양한 형태로 변화가 불가능합니다.<br><img src="/images/post/2018-02-11/class1.jpg"></p>
<h2 id="인터페이스-호출-방식"><a href="#인터페이스-호출-방식" class="headerlink" title="인터페이스 호출 방식"></a>인터페이스 호출 방식</h2><p>클래스를 인터페이스와 인터페이스를 상속받아 구현하는 클래스로 분리했습니다. 구현클래스 교체가 용이하여 다양한 변화가 가능합니다. 그러나 구현클래스 교체시 호출클래스의 코드에서 수정이 필요합니다. (부분적으로 종속적)<br><img src="/images/post/2018-02-11/class2.jpg"></p>
<h2 id="팩토리-호출-방식"><a href="#팩토리-호출-방식" class="headerlink" title="팩토리 호출 방식"></a>팩토리 호출 방식</h2><p>팩토리 방식은 팩토리가 구현클래스를 생성하기 때문에 호출클래스는 팩토리를 호출 하는 코드로 충분합니다. 구현클래스 변경시 팩토리만 수정하면 되기 때문에 호출클래스에는 영향을 미치지 않습니다. 그러나 호출클래스에서 팩토리를 호출하는 코드가 들어가야 하는 것 또한 팩토리에 의존함을 의미합니다.<br><img src="/images/post/2018-02-11/class3.jpg"></p>
<h2 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h2><p>팩토리 패턴의 장점을 더해 어떠한 것에도 의존하지 않는 형태가 되었습니다. 실행시점에 클래스간의 관계가 형성이 됩니다. 즉, <strong>의존성이 삽입된다는 의미로 IoC를 <code>DI</code>라는 표현으로 사용합니다.</strong><br><img src="/images/post/2018-02-11/class4.jpg"></p>
<h1 id="IoC-용어-정리"><a href="#IoC-용어-정리" class="headerlink" title="IoC 용어 정리"></a>IoC 용어 정리</h1><ul>
<li><code>bean</code> : <strong>스프링에서 제어권을 가지고 직접 만들어 관계를 부여하는 오브젝트</strong><br>Java Bean, EJB의 Bean과 비슷한 오브젝트 단위의 애플리케이션 컴포넌트이다. 하지만 스프링을 사용하는 애플리케이션에서 만들어지는 모든 오브젝트가 빈은 아니다. 스프링의 빈은 스프링 컨테이너가 생성하고 관계설정, 사용을 제어해주는 오브젝트를 말한다.</li>
<li><code>bean factory</code> : <strong>스프링의 IoC를 담당하는 핵심 컨테이너</strong><br>Bean을 등록/생성/조회/반환/관리 한다. 보통 bean factory를 바로 사용하지 않고 이를 확장한 application context를 이용한다. BeanFactory는 bean factory가 구현하는 interface이다. (getBean()등의 메서드가 정의되어 있다.)</li>
<li><code>application context</code> : <strong>bean factory를 확장한 IoC 컨테이너</strong><br>Bean의 등록/생성/조회/반환/관리 기능은 bean factory와 같지만, 추가적으로 spring의 각종 부가 서비스를 제공한다. ApplicationContext는 application context가 구현해야 하는 interface이며, BeanFactory를 상속한다.</li>
<li><code>configuration metadata</code> : <strong>application context 혹은 bean factory가 IoC를 적용하기 위해 사용하는 메타정보</strong><br>스프링의 설정정보는 컨테이너에 어떤 기능을 세팅하거나 조정하는 경우에도 사용하지만 주로 bean을 생성/구성하는 용도로 사용한다.</li>
<li><code>container (ioC container)</code> : <strong>IoC 방식으로 bean을 관리한다는 의미에서 bean factory나 application context를 가리킨다.</strong><br>application context는 그 자체로 ApplicationContext 인터페이스를 구현한 오브젝트를 말하기도 하는데, 하나의 애플리케이션에 보통 여러개의 ApplicationContext 객체가 만들어진다. 이를 통칭해서 spring container라고 부를 수 있다.</li>
</ul>
<h1 id="스프링을-사용하지-않을-때-일어날-수-있는-문제"><a href="#스프링을-사용하지-않을-때-일어날-수-있는-문제" class="headerlink" title="스프링을 사용하지 않을 때 일어날 수 있는 문제"></a>스프링을 사용하지 않을 때 일어날 수 있는 문제</h1><p>스프링의 특징을 알아보기 앞서 스프링을 사용하지 않을 때 어떤 문제가 일어날 수 있는지 알아보겠습니다.</p>
<ul>
<li>오브젝트의 생명 주기 문제</li>
<li>부품화 문제</li>
<li>기술 은닉과 부적절한 기술 은닉 문제</li>
</ul>
<p>이러한 문제를 해결하지 않는 한 웹 애플리케이션은 리소스를 잘 이용하지 못하고, 테스트하기 어려우며, 확장이나 변경 또한 어려울 것입니다. 스프링은 이러한 문제를 해결하기 위해 만들어진 컨테이너라고도 할 수 있습니다.<br>스프링은 위의 문제를 다음과 같이 해결합니다.</p>
<ul>
<li>오브젝트의 생명 주기 문제는 DI 컨테이너로 해결</li>
<li>부품화 문제는 DI 컨테이너로 해결</li>
<li>기술 은닉과 부적절한 기술 은닉 문제는 AOP로 해결</li>
</ul>
<h1 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h1><p><strong>IoC는 직관적이지 못하기 때문에 <code>DI(Dependency Injection)</code>라고도 부릅니다.</strong> DI는 오브젝트를 생성하고 오브젝트끼리의 관계를 생성해 소프트웨어의 부품화 및 설계를 가능하게 합니다. DI를 이용하면 인터페이스 기반의 컴포넌트를 쉽게 구현할 수 있습니다.<br>DI를 우리말로 옮기면 의존 관계의 주입입니다. 쉽게 말하면 오브젝트 사이의 의존 관계를 만드는 것입니다. 어떤 오브젝트의 프로퍼티(인스턴스 변수)에 오브젝트가 이용할 오브젝트를 설정한다는 의미입니다. 이를 학술적으로 말하면, 어떤 오브젝트가 의존(이용)할 오브젝트를 주입 혹은 인젝션(프로퍼티에 설정)한다는 것입니다.<br>DI를 구현하는 컨테이너는 단순한 인젝션 외에도 클래스의 인스턴스화 등의 생명 주기 관리 기능이 있는 경우가 많습니다.</p>
<p>클래스에서 new 연산자가 사라졌다는 사실이 중요합니다. 클래스에서 new 연산자가 사라짐으로써 개발자가 팩토리 메서드 같은 디자인 패턴을 구사하지 않아도 <strong>DI 컨테이너가 건내주는 인스턴스를 인터페이스로 받아서 인터페이스 기반의 컴포넌트화를 구현할 수 있게 됐습니다.</strong></p>
<p>DI 컨테이너의 구상 클래스 인스턴스화는(디폴트로는) 1회만 실행합니다. 생성된 인스턴스는 필요한 곳에서 사용합니다. 이렇게 하는 것으로 서비스와 DAO처럼 Singleton으로 만들고 싶은 컴포넌트를 특별히 Singleton으로 만들지 않아도 간단히 실현되게 해줍니다.</p>
<p><strong>스프링에는 크게 (1)XML로 작성된 Bean 정의 파일을 이용한 DI, (2)어노테이션을 이용한 DI, (3)JavaConfig에 의한 DI가 있습니다. 이번 포스팅에서는 어노테이션을 이용한 DI에 대해 알아보겠습니다.</strong></p>
<h2 id="Autowired와-Component"><a href="#Autowired와-Component" class="headerlink" title="@Autowired와 @Component"></a>@Autowired와 @Component</h2><p><strong>인스턴스 변수 앞에 <code>@Autowired</code>를 붙이면 DI 컨테이너가 그 인스턴스 변수의 형에 대입할 수 있는 클래스를 <code>@Component</code>가 붙은 클래스 중에서 찾아내 그 인스턴스를 인젝션해줍니다(정확히는 Bean 정의에서 클래스를 스캔할 범위를 정해야 합니다).</strong><br>인스턴스 변수로의 인젝션은 접근 제어자가 private라도 인젝션 할 수 있으므로 Setter 메서드를 만들 필요는 없습니다. (과거에 캡슐화의 정보 은닉에 반하는 것이 아니냐는 논의가 있었지만, 현재는 편리함에 밀려 그런 논의를 보기 힘들어졌습니다.)</p>
<p>만약 @Component가 붙은 클래스가 여러 개 있어도 형이 다르면 @Autowired가 붙은 인스턴스 변수에 인젝션되지 않습니다. 이렇게 <strong>형을 보고 인젝션하는 방법을 <code>byType</code>이라고 합니다.</strong></p>
<h2 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h2><p>@Autowired는 인스턴스 변수 앞에 붙이는 것 외에도, 다음과 같이 적당한 메서드 선언 앞에도 붙일 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFoo</span><span class="params">(Foo foo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.foo = foo;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFoo</span><span class="params">(Foo foo, Bar bar)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.foo = foo;</span><br><span class="line">    <span class="keyword">this</span>.bar = bar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>또한 생성자에도 이용할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Food</span><span class="params">(Bar b)</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/post/2018-02-11/interface_2_class.png"><br>그런데 위의 사진과 같이 인터페이스에 구현 클래스가 2개여서 @Autowired로 인젝션할 수 있는 클래스의 형이 2개 존재한다면 에러가 발생합니다. <strong>인젝션할 수 있는 클래스의 형은 반드시 하나로 해야합니다.</strong> 하지만 이래서는 인터페이스의 구현 클래스를 테스트용 클래스 등 다른 클래스로 바꿀 경우에 불편합니다. 그래서 이를 회피하는 세 가지 방법에 대해 알아보겠습니다.</p>
<ol>
<li>우선할 디폴트 Bean을 설정하는 @Primary를 @Bean이나 @Component에 부여하는 방법<br>(Bean 정의 파일에서는 <bean primary="true">)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDaoImpl</span> <span class="keyword">implements</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line">...(생략)...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></bean></li>
<li>@Autowired와 병행해서 @Qualifier를 하는 방법<br>단, 이 경우는 @Component에도 이름을 같이 지정해야 한다. 이렇게 인젝션할 클래스를 형이 아닌 이름으로 찾아주는 방법을 byName이라고 한다. (물론 @Component에 같은 이름이 붙은 클래스가 중복되면 오류가 발생한다.)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;productDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ProductDao productDao;</span><br><span class="line"></span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;productDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDaoImpl</span> <span class="keyword">implements</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line">...(생략)...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Bean 정의 파일인 context:component-scan을 이용하는 방법<br>(context:component-scan을 어느 정도 크기의 컴포넌트마다 기술해두고, 만약 어떤 컴포넌트를 테스트용으로 바꾸고자 할 때는 그 컴포넌트 부분의 정의만 테스트용 부품을 스캔하게 수정하는 방법이다.)</li>
</ol>
<h2 id="확장된-Component"><a href="#확장된-Component" class="headerlink" title="확장된 @Component"></a>확장된 @Component</h2><p>@Component에는 확장된 어노테이션이 있습니다. 웹 애플리케이션 개발에는 @Component를 이용할 것이 아니라 <strong>클래스가 어느 레이어에 배치될지 고려해서 배치될 레이어에 있는 @Component 확장 어노테이션을 사용하는 것이 좋습니다.</strong> 예를 들어 ProductServiceImpl은 @Component가 아니라 @Service로 바꾸는 편이 좋고, ProductDaoImpl 클래스도 @Component가 아니라 @Repository로 바꾸는 편이 좋습니다.</p>
<ul>
<li>@Controller : 프레젠테이션 층 스프링 MVC용 어노테이션</li>
<li>@Service : 비즈니스 로직 층 Service용 어노테이션, @Component와 동일</li>
<li>@Repository : 데이터 엑세스 층의 DAO용 어노테이션</li>
<li>@Configuration : Bean 정의를 자바 프로그램에서 실행하는 JavaConfig용 어노테이션</li>
</ul>
<p>@Component와 함께 사용하는 어노테이션의 하나로 @Scope가 있습니다. @Scope 뒤에 Value 속성을 지정하면 인스턴스화와 소멸을 제어할 수 있습니다. @Scope를 생략하면 해당 클래스는 싱글턴이 됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;singletone&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDaoImple</span> <span class="keyword">implements</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line">...(생략)...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>singleton : 인스턴스를 싱글턴으로 함</li>
<li>prototype : 이용할 때마다 인스턴스화함</li>
<li>request : Servlet API의 request 스코프인 동안만 인스턴스가 생존함</li>
<li>session : Servlet API의 session 스코프인 동안만 인스턴스가 생존함</li>
<li>application : Servlet API의 application 스코프인 동안만 인스턴스가 생존함</li>
</ul>
<p>value 속성의 값은 직접 문자열로 넣어도 되지만, 상수가 존재하기 때문에 상수를 사용하는 것이 좋습니다.</p>
<ul>
<li>singleton : BeanDefinition.SCOPE_SINGLETON</li>
<li>prototype : BeanDefinition.SCOPE_PROTOTYPE</li>
<li>request : WebApplicationContext.SCOPE_REQUEST</li>
<li>session : WebApplicationContext.SCOPE_SESSION</li>
<li>application : WebApplicationContext.SCOPE_APPLICATION</li>
</ul>
<h2 id="생명-주기-관리"><a href="#생명-주기-관리" class="headerlink" title="생명 주기 관리"></a>생명 주기 관리</h2><p>스프링 DI 컨테이너에는 인스턴스의 생성과 소멸 타이밍에 호출되는 메서드를 설정할 수 있는 @PosetConstruct와 @PreDestroy라는 2개의 어노테이션이 있습니다.</p>
<ul>
<li>@PostConstruct : 초기 처리를 하는 메서드 선언. 메서드 이름은 임의로 지정할 수 있다. 단, 메서드 인수 없이 반환형은 void 형으로 해야한다.</li>
<li>@PreDestroy : 종료 처리를 하는 메서드 선언. 메서드 이름은 임의로 지정할 수 있다. 단, 메서드 인수 없이 반환형은 void 형으로 해야한다.</li>
</ul>
<p>@PostConstruct는 DI 컨테이너에 의해 인스턴스 변수에 무언가 인젝션된 다음에 호출됩니다. 따라서 인젝션 된 값으로 초기 처리를 할 때 사용합니다. (생성자에서도 초기 처리를 할 수 있습니다.)<br>@PreDestroy는 소멸자가 없는 자바에서 종료 처리를 하기 위해 사용합니다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://wiki.javajigi.net/pages/viewpage.action?pageId=281">Spring Core API 및 IoC(DI)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.javajigi.net/pages/viewpage.action?pageId=5614#SpringIoC%EA%B0%9C%EB%85%90%EB%B0%8F%ED%99%9C%EC%9A%A9%EB%B0%A9%EC%95%88-1.IoC%EC%9D%98%EA%B0%9C%EB%85%90">Spring IoC 개념 및 활용방안</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.javajigi.net/pages/viewpage.action?pageId=68">IoC 컨테이너와 의존성 삽입 패턴</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://okky.kr/article/415474">자바EE의 역사 및 스프링과의 관계</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://isstory83.tistory.com/91">Spring - IoC &amp; DI</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.hanbit.co.kr/store/books/look.php?p_code=B9146679987">스프링4 입문 - 한빛미디어</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-02-05T06:30:00.000Z" title="2/5/2018, 3:30:00 PM">2018-02-05</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:08:34.449Z" title="3/21/2021, 8:08:34 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">27분안에 읽기 (약 4120 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/02/05/Spring/web-with-java/">Java와 함께하는 Web</a></h1><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>Javascript를 이용한 Node.js로 서버프로그래밍을 하다가 최근 <strong>Java를 이용한 Spring Framework를 사용하게 되면서 JavaEE, Servlet, JSP, Tomcat, MVC, WAS와 같은 용어들을 마주하게 되었습니다.</strong> 이번 포스팅을 통해서 Java를 이용한 웹 개발의 히스토리와 여러 용어들을 정리해보고자 합니다.</p>
<h1 id="시작은-JavaEE"><a href="#시작은-JavaEE" class="headerlink" title="시작은 JavaEE"></a>시작은 JavaEE</h1><p>기존에는 기업용 서버 소프트웨어 개발이라는 것이 C나 C++을 사용해서 다양한 회사의 미들웨어(middleware) 제품들을 사용해서 개발하는 방식이었습니다. 그러나 이 경우 개발자들은 운영체제와 사용하는 미들웨어 제품에 종속될 수 밖에 없는데, <strong>자바의 플랫폼 독립적 특성</strong>을 활용해서 미들웨어에 필요한 공통 API를 제공하면 그런 문제를 해결할 수 있을 것이라는 생각을 했습니다.<br>그래서 서버 개발에 필요한 기능을 모아서 J2EE라는 표준을 만들었습니다. 그리고 이 J2EE는 버전 5.0 이후로 Java EE로 개칭됩니다.</p>
<p>자바 플랫폼, 엔터프라이즈 에디션(Java Platform, Enterprise Edition; Java EE)은 자바를 이용한 서버측 개발을 위한 플랫폼입니다. Java EE 플랫폼은 PC에서 동작하는 표준 플랫폼인 Java SE에 부가하여, 웹 애플리케이션 서버에서 동작하는 장애복구 및 분산 멀티티어를 제공하는 자바 소프트웨어의 기능을 추가한 서버를 위한 플랫폼입니다. 이러한 Java EE 스펙에 따라 제품으로 구현한 것을 <code>웹 애플리케이션 서버</code> 또는 <code>WAS</code>라 부릅니다.</p>
<blockquote>
<p><strong>WAS란?</strong><br>인터넷 상에서 HTTP를 통해 사용자 컴퓨터나 장치에 애플리케이션을 수행해 주는 미들웨어(소프트웨어 엔진)이다. <strong>웹 애플리케이션 서버는 동적 서버 콘텐츠를 수행하는 것으로 일반적인 웹 서버와 구별이 되며, 주로 데이터베이스 서버와 같이 수행이 된다.</strong><br><img src="/images/post/2018-02-05/was.png"><br>&lt; 사용자 요청(웹 브라우저) -&gt; 웹 서버 -&gt; WAS(동적 처리) -&gt; 웹 서버 -&gt; 사용자 응답 메세지(웹 브라우저) &gt;<br>예로, 웹 서버에서 JSP를 요청하면 톰캣에서는 JSP 파일을 서블릿으로 변환하여 컴파일을 수행하고, 서블릿의 수행결과를 웹 서버에서 전달하게 된다.</p>
</blockquote>
<p>그렇게 시작된 자바EE는 출발부터 많은 관심을 받았고, 특히 웹 개발을 위해 자바EE 표준에 포함된 **서블릿(Servlet)**과 <strong>JSP</strong>는 당시 막 유행하던 PHP나 ASP와 함께 <code>CGI</code>를 몰아내며 자바 언어가 인기를 얻는데 한 몫을 담당했습니다.</p>
<blockquote>
<p><strong>CGI란?</strong> (인용 - <a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.terms.co.kr/CGI.htm">http://www.terms.co.kr/CGI.htm</a>)<br><strong>CGI는 웹서버에 있어 사용자의 요구를 응용프로그램에 전달하고 그 결과를 사용자에게 되돌려주기 위한 표준적인 방법이다.</strong> 사용자가 하이퍼링크를 클릭 하거나 웹사이트의 주소를 입력함으로써 웹 페이지를 요청하면, 서버는 요청된 페이지를 보내준다. 그러나, 사용자가 웹페이지의 양식에 내용을 기재하여 보냈을 때, 그것은 보통 응용프로그램에 의해 처리될 필요가 있다. 웹 서버는 그 양식 정보를 조그만 응용프로그램에 전달하는데, 이 프로그램은 데이터를 처리하고 필요에 따라 확인 메시지를 보내주기도 한다. 이렇게 <strong>서버와 응용 프로그램간에 데이터를 주고받기 위한 방법이나 규약들을 CGI라고 부른다.</strong> 이것은 웹의 HTTP 프로토콜의 일부이다.<br>만약 웹사이트를 만들 때 어떠한 제어를 위해 CGI 프로그램을 사용하기 원하면, HTML 파일 내에 있는 URL 내에 그 프로그램의 이름을 기술하면 된다. 만약 폼을 만들려고 할 때, 이 URL은 FORMS 태그의 일부로서 기술될 수 있는데, 예를 들어 아래와 같이 쓸 수 있을 것이다.<br>이 태그의 결과로서 mybiz.com에 있는 서버는 입력된 데이터를 저장하기 위해 제어권을 “formprog.pl”이라는 CGI 프로그램에 넘기고, 확인 메시지를 되돌려준다 (여기서 .pl은 Perl로 작성된 프로그램이라는 것을 가리키지만, CGI는 다른 언어로도 작성될 수 있다).</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FORM</span> <span class="attr">METHOD</span>=<span class="string">POST</span> <span class="attr">ACTION</span>=<span class="string">http://www.mybiz.com/cgi-local/formprog.pl</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>자바EE의 핵심은 EJB(Enterprise Java Beans)라는 기술이었습니다. EJB는 자바EE가 대체하는 미들웨어에서 구동되던 기업의 핵심 서비스를 만들기 위한 분산처리 및 트랜잭션, 보안 등을 지원하는 컴포넌트 모델을 제공하는 기술입니다. 이러한 EJB는 주목을 받으며 널리 쓰이게 되었지만 시간이 지남에 따라 몇 가지 심각한 문제들로 비판을 받게 되었고, 이러한 문제점을 개선하기 위해 Spring Framework가 처음 개발되었습니다. 특히 고가의 풀스택 자바EE 서버가 아닌 톰캣과 같은 일반 서블릿 컨테이너에서도 구동된다는 것이 큰 강점으로 작용했습니다.</p>
<p>다시 말하면, 이는 Spring을 통해 비싼 자바EE 서버를 구매하지 않아도 EJB보다 훨씬 간편한 방식으로 EJB가 제공하던 선언적 트랜잭션 및 보안 처리, 분산 환경 지원 등 주요 기능을 모두 사용할 수 있게 되었음을 뜻하며, 무엇보다 이제는 더 이상 각 자바EE 서버 제품에 특화된 설정을 따로 공부하거나 서버 제품을 바꿀 때마다 포팅 작업이 필요없이 Spring만 이용하면 톰캣이든 레진(Resin)이든 기존의 풀스택 자바EE 서버이든 관계없이 간단하게 배포가 가능하다는 뜻입니다.</p>
<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><p><strong><code>Servlet</code>은 Java 기반의 확장된 CGI로서 동일하게 동적인 웹 애플리케이션을 작성할 수 있는 기술입니다.</strong> CGI와 비슷하게 클라이언트의 요청을 받아 해당하는 프로그램을 실행시켜주지만 CGI와는 조금 다른 동작 형태를 보입니다.<br>Servlet은 CGI와 달리 효율적입니다. <strong>CGI의 멀티 프로세스 동작이 아닌 멀티 스레드 방식의 동작으로 서블릿이 생성되면 서버가 종료되지 않는 이상 메모리로 남게 됩니다.</strong> 따라서 이후에 오는 요청에 대해서는 서블릿을 새로 생성하지 않고 동작을 이어갈 수 있기 때문에 시스템 자원(메모리)에서 큰 이점이 있습니다. <strong>그로인해 Servlet은 CGI 보다 적은 시스템 자원으로 많은 요청을 처리할 수 있는 구조를 가지고 있습니다.</strong></p>
<h2 id="멀티-프로세스-동작-방식"><a href="#멀티-프로세스-동작-방식" class="headerlink" title="멀티 프로세스 동작 방식"></a>멀티 프로세스 동작 방식</h2><p><img src="/images/post/2018-02-05/multi_process.png"><br>클라이언트의 요청을 받아 웹 애플리케이션을 직접 실행하는 구조로 <strong>각각의 요청에 대해 프로세스를 생성하고 응답한 뒤 종료하는 형태</strong>이다. 이는 각각의 많은 요청이 들어오는 경우 프로세스를 계속 생성하므로(프로세스를 생성하는 작업은 필요이상의 부담을 주게 된다) 시스템 부하가 커지게 되 안정적인 서비스가 힘들다.</p>
<h2 id="멀티-스레드-동작-방식"><a href="#멀티-스레드-동작-방식" class="headerlink" title="멀티 스레드 동작 방식"></a>멀티 스레드 동작 방식</h2><p><img src="/images/post/2018-02-05/multi_thread.png"><br><strong>클라이언트의 요청을 받으면 웹 애플리케이션을 거치지 않고 <code>웹 컨테이너</code>로 요청이 전달된다. 그리고 웹 컨테이너가 요청을 처리할 스레드를 생성하는 형태이다.</strong> 멀티스레드 방식은 최초 요청 시 웹 애플리케이션을 실행한 후 종료하지 않은 상태에서 같은 요청이 여러 번 오는 경우, 실행되고 있는 웹 애플리케이션의 스레드를 생성해 요청을 처리하는 방법이다. <strong>CGI에서 사용하는 멀티프로세스 방식보다 시스템 부하를 줄여 안정적인 서비스를 제공할 수 있다.</strong></p>
<blockquote>
<p><strong>컨테이너란?</strong> (인용 - <a target="_blank" rel="external nofollow noopener noreferrer" href="http://yayongi.tistory.com/entry/%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C">컨테이너란?? 무엇일까?</a>)<br><strong>컨테이너는 Servlet을 실행하고 관리하는 역할을 합니다. 개발자가 해야하는 역할을 대신 함으로써, 개발자가 해야하는 일을 대폭 줄여줍니다.</strong> 컨테이너는 개발자가 웹서버와 통신하기 위하여 소켓을 생성하고, 특정 포트에 리스닝하고, 스트림을 생성하는 등의 복잡한 일들을 대신합니다. 또한 Servlet의 생성부터 소멸까지 일련의 과정을 관리하며, 요청이 들어올 때마다 새로운 자바 스레드를 하나 생성합니다.<br>톰캣을 예로 들면 아파치와 같은 웹서버가 사용자로부터 Servlet에 대한 요청을 받으면 이것을 바로 호출하는 것이 아니라 컨테이너에게 이 요청을 넘겨주고 이 컨테이너는 <code>request와 response 객체를 생성</code>하고 해당하는 <code>Servlet의 스레드를 생성</code>하여 앞의 <code>두 객체를 인자로 넘깁니다.</code><br>스레드 생성 후 이 <code>스레드의 service() 메소드를 호출</code>하고 처음에 사용자로부터 요청받은 방식이 get인지 post인지에 따라 <code>doGet()과 doPost() 메소드 중 선택 생성</code>합니다. 만약 doPost가 생성되었다고 가정하면, 이 doPost() 메소드는 독 페이지를 생성하고, 이것을 처음 받은 response 객체에 실어서 컨테이너에게 보냅니다. 컨테이너는 <code>이 객체를 HTTPResponse로 변환하여 클라이언트에게 보냅니다.</code> 그런 다음 처음에 생성한 <code>객체 Request와 Response를 소멸</code>시킵니다.</p>
</blockquote>
<h2 id="Servlet-동작-방식"><a href="#Servlet-동작-방식" class="headerlink" title="Servlet 동작 방식"></a>Servlet 동작 방식</h2><p><img src="/images/post/2018-02-05/servlet.png"></p>
<ol>
<li>사용자가 URL을 클릭하면 HTTP Request를 Servlet Container에 보낸다.</li>
<li>Servlet Container는 HttpServletRequest, HttpServletResponse 두 객체를 생성한다.</li>
<li>사용자가 요청한 URL을 분석하여 어느 서블릿에 대한 요청인지 찾는다. (<strong>DD</strong>를 참조하여 분석)</li>
<li>컨테이너는 서블릿 service() 메소드를 호출하며, POST, GET여부에 따라 doGet() 또는 doPost()가 호출된다.</li>
<li>doGet() or doPost() 메소드는 동적인 페이지를 생성한 후 HttpServletResponse객체에 응답을 보낸다.</li>
<li>응답이 완료되면 HttpServletRequest, HttpServletResponse 두 객체를 소멸시킨다.</li>
</ol>
<blockquote>
<p><strong>DD (배포서술자, Deployment Descriptor) = web.xml</strong></p>
</blockquote>
<ul>
<li>Servlet, Error Page, Listener, Fillter, 보안 설정등 Web Application의 설정 파일이다.</li>
<li>URL과 실제 서블릿의 매핑 정보도 담고 있다.</li>
<li>하나의 웹 어플리케이션에 하나만 존재한다.</li>
<li>보통 Web Document Root 디렉토리에 WEB-INF 폴더 아래 web.xml 파일로 존재한다.</li>
</ul>
<p>한마디로 정리하자면 톰캣과 같은 <code>WAS</code> 가 java 파일을 컴파일해서 Class로 만들고 메모리에 올려 <code>Servlet 객체</code>를 만들게 되고 이 <code>Servlet 객체</code>는 <code>doPost</code>, <code>doGet</code>을 통해 요청에 응답합니다. 초기화 과정을 더 자세히 보면 다음과 같습니다.<br><img src="/images/post/2018-02-05/servlet_detail.png"><br><code>init</code>, <code>Service</code>, <code>destory</code> 이런 콜백이 각 시점에 불리는걸 볼 수 있습니다. <code>init</code>은 Servlet이 메모리에 로드 될때 실행됩니다. <code>destory</code>는 마찬가지로 언로드되기 전에 수행되는 콜백입니다. <code>service</code> 메소드는 HTTP Method 타입에 따라 <code>doGet</code> 혹은 <code>doPost</code>를 호출합니다.<br>기억해야 할 점은, 초기화된 Servlet이 클라이언트의 요청이 있을 때 마다 <code>Thread</code>를 생성해서 병렬적으로 <code>service</code>를 수행한다는 것. 서블릿 객체는 <strong>여러개 생성되지 않습니다.</strong></p>
<h2 id="Servlet-예시-코드"><a href="#Servlet-예시-코드" class="headerlink" title="Servlet 예시 코드"></a>Servlet 예시 코드</h2><p>다음은 Servlet의 예시 코드입니다. 자바 코드 안에 HTML을 넣기 굉장히 불편합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span> <span class="keyword">throws</span> ServletException,IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		res.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">		PrintWriter out = res.getWriter();</span><br><span class="line"></span><br><span class="line">		out.println(<span class="string">&quot;&lt;HTML&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;BODY&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;Hello World!!&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;/BODY&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;/HTML&gt;&quot;</span>);</span><br><span class="line">		out.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><p>HTML을 넣기 불편한 구조로 인해 JSP가 등장하게 됬습니다. Servlet의 확장된 기술로 브라우저에 표현하기 위한 HTML 코드에 JAVA 코드를 혼용하여 사용할 수 있게 합니다. 이로써 디자인과 로직 개발을 분업화시켜 효율적인 코드를 생산해 낼 수 있게됩니다.</p>
<h2 id="JSP-동작-방식"><a href="#JSP-동작-방식" class="headerlink" title="JSP 동작 방식"></a>JSP 동작 방식</h2><p>JSP 라는 새로운 개발 방법이 나왔지만, 사실 이 <strong><code>JSP</code> 도 내부적으로는 아래 그림 처럼 <code>Tomcat</code>이 <code>Servlet</code>으로 바꾸어서 돌립니다.</strong><br><img src="/images/post/2018-02-05/jsp.png"></p>
<ol>
<li>클라이언트가 브라우저를 통해 서버에 HTTP 프로토콜로 요청한다.</li>
<li>서버는 컨테이너에게 처리를 요청하고 컨테이너는 해당 파일을 찾는다.</li>
<li>찾은 파일을 서블릿으로 변환한다. 만약 이미 변환 되어있는 파일이 있다면 그 파일을 바로 실행⑤한다.</li>
<li>서블릿 파일을 실행가능한 class파일로 컴파일 한다.</li>
<li>컴파일된 class파일을 메모리에 적재하고 실행한 결과를 웹서버에 넘겨준다.</li>
<li>웹서버는 브라우저가 인식할수 있는 정적페이지를 구성하여 클라이언트에게 응답한다.</li>
</ol>
<h2 id="JSP-예시-코드"><a href="#JSP-예시-코드" class="headerlink" title="JSP 예시 코드"></a>JSP 예시 코드</h2><p>HTML 내부에 Java 코드가 있어 HTML 코드를 작성하기 쉽습니다. 그러나 <strong>로직과 디자인이 한 파일내에 섞여있어 유지보수가 어렵습니다.</strong> 하나가 편한대신, 다른 불편한 점들이 생긴것 입니다. 그래서 이를 해결하기 위해 <code>MVC Model</code>이 등장하였습니다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.Calendar&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">  String str=String.format(<span class="string">&quot;%tF&quot;</span>,Calendar.getInstance());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    오늘은 &lt;%=str%&gt;&lt;br/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="MVC-Model-1"><a href="#MVC-Model-1" class="headerlink" title="MVC Model 1"></a>MVC Model 1</h2><p><img src="/images/post/2018-02-05/mvc_model1.png"><br>Model1 방식은 사용자로부터 요청을 JSP가 받아(더 정확히는 JSP 에서 사용자가 요청을 합니다.) <code>Java Bean</code>(DTO, DAO)을 호출해 처리합니다.<br>이 방식은 개발 속도가 빠르고 배우기 쉽지만 프레젠테이션 로직과 비즈니스 로직이 혼재하기 때문에 JSP 코드가 복잡해져 유지 보수가 어려워진다는 단점이 있습니다.</p>
<h2 id="MVC-Model-2"><a href="#MVC-Model-2" class="headerlink" title="MVC Model 2"></a>MVC Model 2</h2><p><img src="/images/post/2018-02-05/mvc_model2.png"><br>단순히 JSP만 사용하거나, Servlet만 사용하는 것이 아니라 두개의 장단점을 모두 취해 <code>View</code> 는 <code>JSP</code>로, <code>Controller</code>는 <code>Servlet</code>을 사용한 것이 Model2 입니다. 보여지는 부분은 HTML이 중심이 되는 <code>JSP</code>, 다른 자바 클래스에게 데이터를 넘겨주는 부분은 Java 코드가 중심이 되는 <code>Servlet</code>이 담당하게 됩니다. 그리고 <code>Model</code> 영역 에서는 DTO, DAO를 통해 Mysql 과 같은 데이터베이스에 접근합니다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://okky.kr/article/415474">자바EE의 역사 및 스프링과의 관계</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://ko.wikipedia.org/wiki/%EC%9E%90%EB%B0%94_%ED%94%8C%EB%9E%AB%ED%8F%BC,_%EC%97%94%ED%84%B0%ED%94%84%EB%9D%BC%EC%9D%B4%EC%A6%88_%EC%97%90%EB%94%94%EC%85%98">위키백과 - 자바 플랫폼, 엔터프라이즈 에디션</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://dzlove.tistory.com/entry/%EC%84%9C%EB%B8%94%EB%A6%BF-%EC%9E%90%EB%B0%94-%EC%84%9C%EB%B8%94%EB%A6%BF%EC%9C%BC%EB%A1%9C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-%EC%9B%B9-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D">서블릿-자바-서블릿으로-알아보는-웹-프로그래밍</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://myblog.opendocs.co.kr/archives/427">Servlet - Concept</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://a07274.tistory.com/314">Java Servlet 이란? (개념 및 예제)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://anster.tistory.com/128">JSP와 Servlet, 왜 같이 쓸까?</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://myblog.opendocs.co.kr/archives/440">JSP - Concept</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.javajigi.net/pages/viewpage.action?pageId=73">Model1, Model2 개발 방식</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-02-04T14:00:00.000Z" title="2/4/2018, 11:00:00 PM">2018-02-04</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:08:15.963Z" title="3/21/2021, 8:08:15 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a><span> / </span><a class="link-muted" href="/categories/Programming/Spring/">Spring</a></span><span class="level-item">13분안에 읽기 (약 2023 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/02/04/Spring/springboot-start/">IntelliJ에서 SpringBoot 프로젝트 생성하기</a></h1><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>Spring은 J2EE나 JEE로 알려진 자바 엔터프라이즈 에디션을 경량화하기 위해 시작되었다. 스프링은 무거운 엔터프라이즈 자바 빈(EJB)로 컴포넌트를 개발하지 않았다. 그 대신 의존성 주입(DI)과 관점 지향 프로그래밍(AOP)을 활용해서 EJB의 기능을 평범한 자바 객체(POJO)로 구현할 수 있게 하여 간단하게 엔터프라이즈 자바 개발에 접근할 수 있도록 했다.<br>컴포넌트 코드 작성은 가벼워졌지만, <strong>Spring Framework 기반의 웹 프로젝트를 진행하게되면 최초 개발 구성(설정)하는 부분에 많은 시간이 소모되었다.</strong> 결국 애플리케이션 로직 작성이 아닌 프로젝트 구성 작업에 쓰는 시간이 많이 Gk소모되는 것이다.<br><strong><code>SpringBoot</code>는 Spring의 복잡한 설정을 최소화하여 빠르게 프로젝트 개발을 시작할 수 있게 해준다.</strong> 이 포스팅에서는 IntelliJ에서 SpringBoot로 웹 프로젝트를 시작하는 방법을 소개하며 SpringBoot의 특징을 소개한다.</p>
<h1 id="IntelliJ에서-SpringBoot-프로젝트-생성"><a href="#IntelliJ에서-SpringBoot-프로젝트-생성" class="headerlink" title="IntelliJ에서 SpringBoot 프로젝트 생성"></a>IntelliJ에서 SpringBoot 프로젝트 생성</h1><p><strong><code>Spring Initializr</code>는 SpringBoot 프로젝트 구조를 만드는 웹 애플리케이션이다.</strong> 기본적인 프로젝트 구조와 코드를 빌드하는 데 필요한 maven이나 gradle 빌드 명세를 만들어준다. 그러므로 Spring Initializr가 만든 프젝트에 애플리케이션 코드만 작성하면 된다.<br>Spring Initializr는 웹 기반 인터페이스, Spring Tool Suite(STS), IntelliJ IDE, SpringBoot CLI로 사용할 수 있다. 그 중 IntelliJ를 사용해 프로젝트를 생성해보자.</p>
<p>IntelliJ를 시작하여 <strong>Create New Project</strong>를 선택하고 새로운 프로젝트 다이얼로그를 연다. <strong>New Project</strong> 다이얼로그에서 <strong>Spring Initializr</strong> 프로젝트를 선택하고 자바 SDK를 설정한 후 Next 버튼을 누른다.<br><img src="/images/post/2018-02-04/new_project_1.png"></p>
<p>두 번째 화면에서는 프로젝트 이름, 빌드할 때 maven과 gradle 중 어느 것을 사용할지, 자바 버전 등 프로젝트의 기본적인 사항을 물어본다. 프로젝트 정보를 입력하고 Next 버튼을 누른다.<br><img src="/images/post/2018-02-04/new_project_2.png"></p>
<p>세 번째 화면에서는 프로젝트에서 필요한 종류의 의존성을 추가한다. <strong>Web, Thymeleaf, JPA, H2</strong>를 선택한 후 Next 버튼을 누른다.<br><img src="/images/post/2018-02-04/new_project_3.png"></p>
<p>다음으로 프로젝트가 저장되는 경로를 지정한다.<br><img src="/images/post/2018-02-04/new_project_4.png"></p>
<p>Gradle 설정을 지정한다.<br><img src="/images/post/2018-02-04/new_project_5.png"></p>
<h1 id="코드-작성"><a href="#코드-작성" class="headerlink" title="코드 작성"></a>코드 작성</h1><h2 id="도메인-정의-Diary-java"><a href="#도메인-정의-Diary-java" class="headerlink" title="도메인 정의 (Diary.java)"></a>도메인 정의 (Diary.java)</h2><p><strong>src/main/java/com.example.demo/Diary.java</strong> 파일을 작성한다.<br>일기를 나타내는 엔티티 정의한다. 간단하게 id, title, ocntent 필드를 갖고 있는 <strong>POJO 객체</strong>로 만든다. <code>@Entity</code> 어노테이션을 붙여 클래스를 JPA 엔티티로 지정했고, id 필드에는 <code>@Id</code>와 <code>@GeneratedValue</code> 어노테이션을 붙여 엔티티의 유일성을 식별하고 자동으로 값을 제공하는 필드로 지정했다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Diary</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="레파지토리-인터페이스-선언-DiaryListRepository-java"><a href="#레파지토리-인터페이스-선언-DiaryListRepository-java" class="headerlink" title="레파지토리 인터페이스 선언 (DiaryListRepository.java)"></a>레파지토리 인터페이스 선언 (DiaryListRepository.java)</h2><p><strong>src/main/java/com.example.demo/DiaryListRepository.java</strong> 파일을 작성한다.<br><strong>데이터베이스에 Diary 객체를 저장할 수 있는 레파지토리를 선언한다.</strong> 스프링 JPA를 사용하므로 스프링 데이터 JAP의 인터페이스를 상속하여 인터페이스를 만든다. JpaRepository 인터페이스는 타입 매개변수 두 개를 받는다. 첫 번째는 레파지토리가 사용할 도메인 타입, 두번 째는 클래스의 ID 프로퍼티 타입이다. 지정한 유저의 이름으로 도서 목록을 검색하는 findByUser() 메서드를 추가했다.<br>DiaryListRepository는 JpaRepository 인터페이스를 상속받아 18개의 메서드를 구현해야 한다. 그러나 스프링 데이터는 레파지토리를 인터페이스로 정의만 해도 잘 작동할 수 있게 런타임 시에 자동으로 구현해준다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DiaryListRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Diary</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Diary&gt; <span class="title">findByUser</span><span class="params">(String user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="일기-목록-애플리케이션의-스프링-MVC-컨트롤러-DiaryListController-java"><a href="#일기-목록-애플리케이션의-스프링-MVC-컨트롤러-DiaryListController-java" class="headerlink" title="일기 목록 애플리케이션의 스프링 MVC 컨트롤러 (DiaryListController.java)"></a>일기 목록 애플리케이션의 스프링 MVC 컨트롤러 (DiaryListController.java)</h2><p><strong>src/main/java/com.example.demo/DiaryListController.java</strong> 파일을 작성한다.<br>클래스에 <code>@Controller</code> 어노테이션을 추가하면, 자동 컴포넌트 검색으로 DiaryListController를 발견해 자동으로 스프링 애플리케이션 컨텍스트에 빈으로 등록한다. 요청을 처리하는 모든 메서드를 기본 URL 경로인 /로 매핑하기 위해 <code>@RequestMapping</code> 어노테이션을 붙였다.<br>usersDiarys() 메서드는 “diaryList”를 논리적 뷰 이름으로 반환한다. 그러므로 이 뷰도 만들어야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DiaryListController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String user=<span class="string">&quot;jongmin&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DiaryListRepository diaryListRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DiaryListController</span><span class="params">(DiaryListRepository diaryListRepository)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.diaryListRepository = diaryListRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(method= RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">usersDiarys</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;Diary&gt; diaryList = diaryListRepository.findByUser(user);</span><br><span class="line">        <span class="keyword">if</span> (diaryList != <span class="keyword">null</span>) &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;diarys&quot;</span>, diaryList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;diaryList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addToReadingList</span><span class="params">(Diary diary)</span> </span>&#123;</span><br><span class="line">        diary.setUser(user);</span><br><span class="line">        diaryListRepository.save(diary);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="일기-목록을-보여주는-Thymeleaf-탬플릿-diaryList-html"><a href="#일기-목록을-보여주는-Thymeleaf-탬플릿-diaryList-html" class="headerlink" title="일기 목록을 보여주는 Thymeleaf 탬플릿 (diaryList.html)"></a>일기 목록을 보여주는 Thymeleaf 탬플릿 (diaryList.html)</h2><p><strong>src/main/resources/template/diaryList.html</strong> 파일을 작성한다.<br>유저의 일기 목록 부분과 일기를 일기 목록에 추가할 때 사용하는 입력 폼을 작성한다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span> xmlns:th=<span class="string">&quot;http://www.springframework.org/schema/data/jaxb&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">  &lt;title&gt;일기 리스트&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;일기 목록&lt;/h2&gt;</span><br><span class="line">&lt;div th:unless=<span class="string">&quot;$&#123;#lists.isEmpty(diarys)&#125;&quot;</span>&gt;</span><br><span class="line">  &lt;dl th:each=<span class="string">&quot;diary : $&#123;diarys&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;dt&gt;</span><br><span class="line">      &lt;span th:if=&quot;$&#123;diary.title&#125;&quot; th:text=&quot;$&#123;diary.title&#125;&quot;&gt;Title&lt;/span&gt;</span><br><span class="line">    &lt;/dt&gt;</span><br><span class="line">    &lt;dd&gt;</span><br><span class="line">      &lt;span th:if=&quot;$&#123;diary.content&#125;&quot; th:text=&quot;$&#123;diary.content&#125;&quot;&gt;Content&lt;/span&gt;</span><br><span class="line">    &lt;/dd&gt;</span><br><span class="line">  &lt;/dl&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;일기 작성&lt;/h3&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;POST&quot;</span> th:action=<span class="string">&quot;@&#123;/&#125;&quot;</span>&gt;</span><br><span class="line">  &lt;label for=&quot;title&quot;&gt;Title:&lt;/label&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;title&quot;</span> size=<span class="string">&quot;50&quot;</span> /&gt;&lt;br /&gt;</span><br><span class="line">  &lt;label for=&quot;content&quot;&gt;Content:&lt;/label&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;content&quot;</span> size=<span class="string">&quot;100&quot;</span> /&gt;&lt;br /&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;추가&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h1 id="실행-결과"><a href="#실행-결과" class="headerlink" title="실행 결과"></a>실행 결과</h1><p><img src="/images/post/2018-02-04/result.png"></p>
<h1 id="SpringBoot-특징-살펴보기"><a href="#SpringBoot-특징-살펴보기" class="headerlink" title="SpringBoot 특징 살펴보기"></a>SpringBoot 특징 살펴보기</h1><p>SpringBoot를 이용해 간단한 애플리케이션을 만들어 보았다. 이 애플리케이션을 바탕으로 SpringBoot의 특징을 알아보자.</p>
<h2 id="스타터-의존성"><a href="#스타터-의존성" class="headerlink" title="스타터 의존성"></a>스타터 의존성</h2><p>처음 프로젝트를 생성하며 Spring Initializr에서 필요한 Dependencies들(Web, Thymeleaf, JPA, H2)을 쉽게 추가했었다. 만약 이런 <code>스타터 의존성</code>이 없었다면, 애플리케이션을 개발하기도 전에 <strong>build.gradle</strong> 또는 <strong>pom.xml</strong>에서 필요한 Dependencies를 직접 추가해야했을 것이다. (또햔, 여러 의존성들 사이에 잘 호환이 되는지도 확인해야 한다.)</p>
<p>프로젝트의 <strong>build.gradle</strong> 코드를 잠시 살펴보자.</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">	<span class="keyword">compile</span>(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-data-jpa&#x27;</span>)</span><br><span class="line">	<span class="keyword">compile</span>(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-thymeleaf&#x27;</span>)</span><br><span class="line">	<span class="keyword">compile</span>(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-web&#x27;</span>)</span><br><span class="line">	<span class="keyword">runtime</span>(<span class="string">&#x27;com.h2database:h2&#x27;</span>)</span><br><span class="line">	testCompile(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring Initializr에서 체크했던 의존성들이 gradle에 추가되어 있는것을 볼 수 있다. 또한 각 라이브러리의 버전이 명시되어 있지 않은데, 이는 SpringBoot 버전에 따라 스타터 의존성 버전이 결정되기 때문이다. 즉, 사용자는 스타터 의존성만 지정하면 어떤 라이브러리와 어떤 버전을 사용해야 하는지 걱정없이 구성에서 자유로워질 수 있는 것이다.</p>
<h2 id="자동-구성"><a href="#자동-구성" class="headerlink" title="자동 구성"></a>자동 구성</h2><p>SpringBoot <code>Auto-configuration</code>은 <strong>스프링 구성을 적용해야 할지 말지를 결정하는 요인들을 판단하는 런타임 과정이다.</strong> 애플리케이션이 시작될 때마다 스프링 부트는 보안, 통합, 데이터 저장, 웹 개발 영역 등을 커버하기 위해 자도성에서 대략 200가지 정도 결정을 내린다. 이 자동 구성 덕분에 필요한 상황이 아니면 명시적으로 구성을 작성하지 않아도 된다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>스프링 부트 코딩 공작소</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://blog.saltfactory.net/creating-springboot-project-in-intellij/">http://blog.saltfactory.net/creating-springboot-project-in-intellij/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-01-31T14:00:00.000Z" title="1/31/2018, 11:00:00 PM">2018-01-31</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:53.575Z" title="3/21/2021, 8:06:53 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">3분안에 읽기 (약 423 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/01/31/Programming/android-customize-network-timeouts/">Retrofit2 네트워크 타임아웃 시간 설정하기</a></h1><div class="content"><p>Retrofit은 기본적인 네트워크 타임아웃 시간 설정을 사용하고 있습니다. 그러나 <strong>여러 상황으로 인해 기본적으로 설정된 타임아웃 시간을 변경할 필요가 생기기도 합니다.</strong><br>이번 포스팅에서는 3가지의 네트워크 타임아웃 시간 설정에 대해 알아보고 변경해보겠습니다.</p>
<h2 id="타임아웃-시간-설정"><a href="#타임아웃-시간-설정" class="headerlink" title="타임아웃 시간 설정"></a>타임아웃 시간 설정</h2><p>Retrofit에서는 기본적으로 다음의 3가지 타임아웃 시간 설정 값을 갖고 있습니다.</p>
<ul>
<li>Connection timeout : 10초</li>
<li>Read timeout : 10초</li>
<li>Write timeout : 10초</li>
</ul>
<h3 id="Connection-Timeout"><a href="#Connection-Timeout" class="headerlink" title="Connection Timeout"></a>Connection Timeout</h3><p><strong>요청을 시작한 후 서버와의 TCP handshake가 완료되기까지 지속되는 시간이다.</strong> 즉, Retrofit이 설정된 연결 시간 제한 내에서 서버에 연결할 수없는 경우 해당 요청을 실패한 것으로 계산한다.<br>따라서 사용자의 인터넷 연결 상태가 좋지 않을때 기본 시간 제한인 10초를 더 높은 값으로 설정하면 좋다.</p>
<h3 id="Read-Timeout"><a href="#Read-Timeout" class="headerlink" title="Read Timeout"></a>Read Timeout</h3><p><strong>읽기 시간 초과는 연결이 설정되면 모든 바이트가 전송되는 속도를 감시한다.</strong> 서버로부터의 응답까지의 시간이 읽기 시간 초과보다 크면 요청이 실패로 계산된다.<br><code>LongPolling</code>을 위해 변경해 주어야 하는 설정값이다.</p>
<h3 id="Write-Timeout"><a href="#Write-Timeout" class="headerlink" title="Write Timeout"></a>Write Timeout</h3><p><strong>쓰기 타임 아웃은 읽기 타임 아웃의 반대 방향이다. 얼마나 빨리 서버에 바이트를 보낼 수 있는지 확인한다.</strong></p>
<h2 id="코드"><a href="#코드" class="headerlink" title="코드"></a>코드</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">        .connectTimeout(<span class="number">1</span>, TimeUnit.MINUTES)</span><br><span class="line">        .readTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">        .writeTimeout(<span class="number">15</span>, TimeUnit.SECONDS)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">Retrofit.Builder builder = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .baseUrl(<span class="string">&quot;http://localhost:3000/&quot;</span>)</span><br><span class="line">        .client(okHttpClient)</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create());</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-01-29T12:00:00.000Z" title="1/29/2018, 9:00:00 PM">2018-01-29</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:57.852Z" title="3/21/2021, 8:06:57 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">14분안에 읽기 (약 2078 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/01/29/Programming/android-retrofit2-okhttp3/">Retrofit2 + OkHttp3 사용하기</a></h1><div class="content"><p>신입사원 프로젝트로 간만에 안드로이드 개발을 하게됐습니다. 서버와 통신하기위해 Square에서 만든 Retrofit 라이브러리를 사용했는데, 기존에 사용하던 버전(1.x)과 변경된 부분이 많아 새롭게 사용법을 알아보고자 합니다.<br>Retrofit 테스트는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://reqres.in/">API 테스트 사이트</a>를 통해서 Fake data를 가져오는 실습을 해보겠습니다. 해당 글의 대부분은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.journaldev.com/13639/retrofit-android-example-tutorial">Retrofit 2.0 Example</a>을 참고했습니다.</p>
<h2 id="Retrofit2"><a href="#Retrofit2" class="headerlink" title="Retrofit2"></a>Retrofit2</h2><p>Retrofit 의외에 다른 라이브러리도 있지만, Retrofit을 사용하기로 한 이유는 성능과 간단한 구현방법 때문입니다. 아래 보시는것과 같이 응답속도가 매우 빠른것으로 나와있습니다. 더 자세한 비교는 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/">Android Async HTTP Clients: Volley vs Retrofit</a>에서 볼 수 있습니다.</p>
<p><img src="/images/post/2018-01-29/retrofit_benchmark.png" alt="Retrofit Benchmark"></p>
<p>Retrofit2는 기본적으로 OkHttp를 네트워킹 계층으로 활용하며 그 위에 구축됩니다.</p>
<p>Retrofit은 자동적으로 JSON 응답을 사전에 정의된 POJO를 통해 직렬화 할 수 있습니다. JSON을 직렬화 하기 위해서는 먼저 Gson converter가 필요합니다. **<code>build.gradle</code>**에 다음의 dependencies를 추가합니다.</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:retrofit:2.3.0&#x27;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.google.code.gson:gson:2.8.0&#x27;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.1.0&#x27;</span></span><br></pre></td></tr></table></figure>
<p>OkHttp는 이미 Retrofit2 모듈의 종속성에 포함되어 있어, 별도의 OkHttp 설정이 필요하다면 다음과 같이 Retrofit2에서 OkHttp 종속성을 제외해야 합니다.</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">compile</span>(<span class="string">&#x27;com.squareup.retrofit2:retrofit:2.3.0&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">exclude</span> module: <span class="string">&#x27;okhttp&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.google.code.gson:gson:2.8.0&#x27;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.1.0&#x27;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.squareup.okhttp3:okhttp:3.9.1&#x27;</span></span><br><span class="line"><span class="keyword">compile</span> <span class="string">&#x27;com.squareup.okhttp3:logging-interceptor:3.9.1&#x27;</span></span><br><span class="line"><span class="comment">// logging-interceptor는 반환된 모든 응답에 대해 로그 문자열을 생성합니다.</span></span><br></pre></td></tr></table></figure>

<p>네트워크 사용을 위해서 **<code>AndroidManifest.xml</code>**에서 Internet Permission을 추가합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="OkHttp-Interceptors"><a href="#OkHttp-Interceptors" class="headerlink" title="OkHttp Interceptors"></a>OkHttp Interceptors</h2><p>**<code>Interceptor</code>**는 OkHttp에 있는 강력한 메커니즘으로 호출을 모니터, 재 작성 및 재 시도를 할 수 있습니다. Interceptor는 크게 두 가지 카테고리로 분류할 수 있습니다.</p>
<ul>
<li><strong>Application Interceptors</strong> : Application Interceptor를 등록하려면 <code>OkHttpClient.Builder</code>에서 <code>addInterceptor()</code>를 호출해야 합니다.</li>
<li><strong>Network Interceptors</strong> : Network Interceptor를 등록하려면 <code>addInterceptor()</code> 대신 <code>addNetworkInterceptor()</code>를 추가해야 합니다.</li>
</ul>
<h2 id="Retrofit-Interface-설정"><a href="#Retrofit-Interface-설정" class="headerlink" title="Retrofit Interface 설정"></a>Retrofit Interface 설정</h2><h3 id="APIClient-java"><a href="#APIClient-java" class="headerlink" title="APIClient.java"></a>APIClient.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> okhttp3.logging.HttpLoggingInterceptor;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Retrofit;</span><br><span class="line"><span class="keyword">import</span> retrofit2.converter.gson.GsonConverterFactory;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">APIClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Retrofit retrofit = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Retrofit <span class="title">getClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HttpLoggingInterceptor interceptor = <span class="keyword">new</span> HttpLoggingInterceptor();</span><br><span class="line">        interceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder().addInterceptor(interceptor).build();</span><br><span class="line"></span><br><span class="line">        retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">                .baseUrl(<span class="string">&quot;https://reqres.in/&quot;</span>)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .client(client)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> retrofit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getClient()</code> 메서드는 Retrofit 인터페이스를 설정할 때마다 호출됩니다. Retrofit은 **<code>@GET, @POST, @PUT, @DELETE, @PATCH or @HEAD</code>**와 같은 <strong>annotation</strong>을 통해 HTTP method를 이용합니다.</p>
<h3 id="APIInterface-java"><a href="#APIInterface-java" class="headerlink" title="APIInterface.java"></a>APIInterface.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.MultipleResource;</span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.UserList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> retrofit2.Call;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.Body;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.Field;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.FormUrlEncoded;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.GET;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.POST;</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.Query;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">APIInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;api/unknown&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;MultipleResource&gt; <span class="title">doGetListResources</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST(&quot;api/users&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;User&gt; <span class="title">createUser</span><span class="params">(<span class="meta">@Body</span> User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;api/users?&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;UserList&gt; <span class="title">doGetUserList</span><span class="params">(<span class="meta">@Query(&quot;page&quot;)</span> String page)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@FormUrlEncoded</span></span><br><span class="line">    <span class="meta">@POST(&quot;api/users?&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;UserList&gt; <span class="title">doCreateUserWithField</span><span class="params">(<span class="meta">@Field(&quot;name&quot;)</span> String name, <span class="meta">@Field(&quot;job&quot;)</span> String job)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위의 클래스에서 Annotation을 통해 테스트 HTTP request를 작성했습니다. 해당 API로 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://reqres.in/">이곳</a>을 통해 테스트 할 것입니다.</p>
<p><code>@GET(&quot;api/unknown&quot;)</code>은  <code>doGetListResources()</code>를 호출합니다.<br><code>doGetListResources()</code>은 메서드 이름입니다. <code>MultipleResource.java</code>는 응답 객체의 Model POJO 클래스로서 Response parameter를 각각의 변수에 매핑하는 데 사용됩니다. 이러한 POJO 클래스는 메소드 리턴 유형으로 동작합니다.</p>
<h3 id="MultipleResources-java"><a href="#MultipleResources-java" class="headerlink" title="MultipleResources.java"></a>MultipleResources.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.annotations.SerializedName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipleResource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SerializedName(&quot;page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer page;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;per_page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer perPage;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;total&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer total;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;total_pages&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer totalPages;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Datum&gt; data = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Datum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SerializedName(&quot;id&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Integer id;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;name&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;year&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Integer year;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;pantone_value&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String pantoneValue;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@SerializedName</code> 어노테이션은 JSON 응답에서 각각의 필드를 구분하기 위해 사용합니다.</p>
<p><strong># Tip)</strong> <a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.jsonschema2pojo.org/">jsonschema2pojo</a> 에서 json 응답의 구조를 바탕으로 해당 응답에 대한 POJO 클래스를 쉽게 만들 수 있습니다.</p>
<p><img src="/images/post/2018-01-29/jsonschema2pojo.png" alt="Json Schema -&gt; POJO"></p>
<p>POJO 클래스는 Retrofit Call 클래스로 래핑됩니다. (JSONArray는 POJO 클래스의 객체 목록으로 직렬화됩니다.)</p>
<p><strong>Method Parameters</strong> : 메서드 내에서 전달할 수 있는 다양한 매개 변수 옵션이 있습니다.</p>
<ul>
<li><strong>@Body</strong> - request body로 Java 객체를 전달합니다.</li>
<li><strong>@Url</strong> - 동적인 URL이 필요할때 사용합니다.</li>
<li><strong>@Query</strong> - 쿼리를 추가할 수 있으며, 쿼리를 URL 인코딩하려면 다음과 같이 작성합니다.<br>@Query(value = “auth_token”,encoded = true) String auth_token</li>
<li><strong>@Field</strong> - POST에서만 동작하며 form-urlencoded로 데이터를 전송합니다. 이 메소드에는 @FormUrlEncoded 어노테이션이 추가되어야 합니다.</li>
</ul>
<h2 id="Android-Retrofit-예제-프로젝트-구조"><a href="#Android-Retrofit-예제-프로젝트-구조" class="headerlink" title="Android Retrofit 예제 프로젝트 구조"></a>Android Retrofit 예제 프로젝트 구조</h2><p><img src="/images/post/2018-01-29/android-retrofit-project-structure.png" alt="Android Retrofit 예제 프로젝트 구조"></p>
<p>pojo 패키지는 <strong>APIInterface.java</strong> 클래스에 정의된 각각의 API 요청 응답에 대한 4가지 모델 클래스를 정의하고 있습니다.</p>
<h3 id="User-java"><a href="#User-java" class="headerlink" title="User.java"></a>User.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.annotations.SerializedName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SerializedName(&quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;job&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String job;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;createdAt&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, String job)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.job = job;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 클래스는 <strong>createUser()</strong> 메서드에 대한 응답을 위해 사용합니다.</p>
<h3 id="UserList-java"><a href="#UserList-java" class="headerlink" title="UserList.java"></a>UserList.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.annotations.SerializedName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SerializedName(&quot;page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer page;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;per_page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer perPage;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;total&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer total;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;total_pages&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer totalPages;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Datum&gt; data = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Datum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SerializedName(&quot;id&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Integer id;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;first_name&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String first_name;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;last_name&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String last_name;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;avatar&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String avatar;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CreateUserResponse-java"><a href="#CreateUserResponse-java" class="headerlink" title="CreateUserResponse.java"></a>CreateUserResponse.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.annotations.SerializedName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateUserResponse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SerializedName(&quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;job&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String job;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="meta">@SerializedName(&quot;createdAt&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String createdAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MainActivity-java"><a href="#MainActivity-java" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h3><p>**<code>MainActivity.java</code>**는 Interface 클래스에 정의된 각각의 API를 호출하고 그 결과를 Toast와 TextView를 통해 표시하고 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.journaldev.retrofitintro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.CreateUserResponse;</span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.MultipleResource;</span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.journaldev.retrofitintro.pojo.UserList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> retrofit2.Call;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Callback;</span><br><span class="line"><span class="keyword">import</span> retrofit2.Response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView responseText;</span><br><span class="line">    APIInterface apiInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        responseText = (TextView) findViewById(R.id.responseText);</span><br><span class="line">        apiInterface = APIClient.getClient().create(APIInterface.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         GET List Resources</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        Call&lt;MultipleResource&gt; call = apiInterface.doGetListResources();</span><br><span class="line">        call.enqueue(<span class="keyword">new</span> Callback&lt;MultipleResource&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;MultipleResource&gt; call, Response&lt;MultipleResource&gt; response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                Log.d(<span class="string">&quot;TAG&quot;</span>,response.code()+<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">                String displayResponse = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">                MultipleResource resource = response.body();</span><br><span class="line">                Integer text = resource.page;</span><br><span class="line">                Integer total = resource.total;</span><br><span class="line">                Integer totalPages = resource.totalPages;</span><br><span class="line">                List&lt;MultipleResource.Datum&gt; datumList = resource.data;</span><br><span class="line"></span><br><span class="line">                displayResponse += text + <span class="string">&quot; Page\n&quot;</span> + total + <span class="string">&quot; Total\n&quot;</span> + totalPages + <span class="string">&quot; Total Pages\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (MultipleResource.Datum datum : datumList) &#123;</span><br><span class="line">                    displayResponse += datum.id + <span class="string">&quot; &quot;</span> + datum.name + <span class="string">&quot; &quot;</span> + datum.pantoneValue + <span class="string">&quot; &quot;</span> + datum.year + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                responseText.setText(displayResponse);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;MultipleResource&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                call.cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         Create new user</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;morpheus&quot;</span>, <span class="string">&quot;leader&quot;</span>);</span><br><span class="line">        Call&lt;User&gt; call1 = apiInterface.createUser(user);</span><br><span class="line">        call1.enqueue(<span class="keyword">new</span> Callback&lt;User&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;User&gt; call, Response&lt;User&gt; response)</span> </span>&#123;</span><br><span class="line">                User user1 = response.body();</span><br><span class="line"></span><br><span class="line">                Toast.makeText(getApplicationContext(), user1.name + <span class="string">&quot; &quot;</span> + user1.job + <span class="string">&quot; &quot;</span> + user1.id + <span class="string">&quot; &quot;</span> + user1.createdAt, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;User&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                call.cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         GET List Users</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        Call&lt;UserList&gt; call2 = apiInterface.doGetUserList(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        call2.enqueue(<span class="keyword">new</span> Callback&lt;UserList&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;UserList&gt; call, Response&lt;UserList&gt; response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                UserList userList = response.body();</span><br><span class="line">                Integer text = userList.page;</span><br><span class="line">                Integer total = userList.total;</span><br><span class="line">                Integer totalPages = userList.totalPages;</span><br><span class="line">                List&lt;UserList.Datum&gt; datumList = userList.data;</span><br><span class="line">                Toast.makeText(getApplicationContext(), text + <span class="string">&quot; page\n&quot;</span> + total + <span class="string">&quot; total\n&quot;</span> + totalPages + <span class="string">&quot; totalPages\n&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (UserList.Datum datum : datumList) &#123;</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;id : &quot;</span> + datum.id + <span class="string">&quot; name: &quot;</span> + datum.first_name + <span class="string">&quot; &quot;</span> + datum.last_name + <span class="string">&quot; avatar: &quot;</span> + datum.avatar, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;UserList&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                call.cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         POST name and job Url encoded.</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        Call&lt;UserList&gt; call3 = apiInterface.doCreateUserWithField(<span class="string">&quot;morpheus&quot;</span>,<span class="string">&quot;leader&quot;</span>);</span><br><span class="line">        call3.enqueue(<span class="keyword">new</span> Callback&lt;UserList&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;UserList&gt; call, Response&lt;UserList&gt; response)</span> </span>&#123;</span><br><span class="line">                UserList userList = response.body();</span><br><span class="line">                Integer text = userList.page;</span><br><span class="line">                Integer total = userList.total;</span><br><span class="line">                Integer totalPages = userList.totalPages;</span><br><span class="line">                List&lt;UserList.Datum&gt; datumList = userList.data;</span><br><span class="line">                Toast.makeText(getApplicationContext(), text + <span class="string">&quot; page\n&quot;</span> + total + <span class="string">&quot; total\n&quot;</span> + totalPages + <span class="string">&quot; totalPages\n&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (UserList.Datum datum : datumList) &#123;</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;id : &quot;</span> + datum.id + <span class="string">&quot; name: &quot;</span> + datum.first_name + <span class="string">&quot; &quot;</span> + datum.last_name + <span class="string">&quot; avatar: &quot;</span> + datum.avatar, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;UserList&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                call.cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>apiInterface = APIClient.getClient().create(APIInterface.class);</code>는 APIClient를 인스턴스화 하기위해 사용됩니다.<br>API 응답에 Model 클래스를 매핑하기 위해서는 다음과 같이 사용합니다.<br><code>MultipleResource resource = response.body();</code></p>
<p>이제 앱을 실행하면 각 API를 호출하고 이에 따라 토스트 메시지를 표시합니다.</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://instructure.github.io/blog/2013/12/09/volley-vs-retrofit/">Volley vs Retrofit</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.journaldev.com/13629/okhttp-android-example-tutorial">OkHttp Example</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2018-01-20T06:30:00.000Z" title="1/20/2018, 3:30:00 PM">2018-01-20</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:55.692Z" title="3/21/2021, 8:06:55 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">10분안에 읽기 (약 1546 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/01/20/Programming/android-naver-login/">OAuth 2.0과 네이버로 로그인</a></h1><div class="content"><p>안드로이드에서 <strong>&lt;네이버 아이디로 로그인&gt;</strong> 기능을 구현하며 <strong>OAuth 2.0</strong>에 대해 알아보고, 라이브러리를 적용하는 방법에 대해 알아보겠습니다.</p>
<h2 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h2><p>OAuth는 **<code>인증(Authentication)과 허가(Authorization)</code>**을 위한 표준 프로토콜로, 사용자가 Facebook이나 트위터 같은 인터넷 서비스의 기능을 다른 애플리케이션(데스크톱, 웹, 모바일 등)에서도 사용할 수 있게 한 것입니다.</p>
<p>Facebook이나 트위터의 기능을 이용하기 위해 사용자가 반드시 Facebook이나 트위터에 로그인해야 하는 것이 아니라, 별도의 인증 절차를 거치면 다른 서비스에서 Facebook과 트위터의 기능을 이용할 수 있게 됩니다. 이런 방식은 Facebook이나 트위터 같은 서비스 제공자뿐만 아니라 사용자와 여러 인터넷 서비스 업체 모두에 이익이 되는 생태계를 구축하는데 기여했습니다.<br>이 방식에서 사용하는 **인증 절차가 <code>OAuth</code>**입니다.</p>
<p>OAuth를 이용하면 이 인증을 공유하는 애플리케이션끼리는 별도의 인증이 필요없습니다. 따라서 여러 애플리케이션을 통합하여 사용하는 것이 가능하게 됩니다.</p>
<p><strong>OAuth 2.0은 authorization(허가, 승인)을 위한 산업 표준 프로토콜</strong>입니다. OAuth 2.0 전에 OAuth 1.0이 만들어져 사용되었지만 웹, 데스크탑, 모바일 등의 어플리케이션의 authorization flow(권한 흐름)을 보다 단순화 하는데 초점이 맞춰졌습니다.<br>(OAuth 1.0에서는 Acess Token을 받으면 계속 사용이 가능했습니다. 그러나 OAuth 2.0에서는 보안 강화를 위해 Access Token의 Life-time을 지정할 수 있게됐고, Life-time이 만료되면 Refresh Token을 통해 Access Token을 재발급을 받아야 합니다.)</p>
<h2 id="주의사항"><a href="#주의사항" class="headerlink" title="주의사항"></a>주의사항</h2><p><strong><code>로그인과 OAuth는 반드시 분리해서 이해해야 합니다.</code></strong> 아래의 예시를 통해 그 이유를 생각해봅시다.</p>
<blockquote>
<p>사원증을 이용해 출입할 수 있는 회사를 생각해 보자. 그런데 외부 손님이 그 회사에 방문할 일이 있다. 회사 사원이 건물에 출입하는 것이 로그인이라면 OAuth는 방문증을 수령한 후 회사에 출입하는 것에 비유할 수 있다. 방문증이란 사전에 정해진 곳만 다닐 수 있도록 하는 것이니, ‘방문증’을 가진 사람이 출입할 수 있는 곳과 ‘사원증’을 가진 사람이 출입할 수 있는 곳은 다르다. 역시 직접 서비스에 로그인한 사용자와 OAuth를 이용해 권한을 인증받은 사용자는 할 수 있는 일이 다르다.</p>
</blockquote>
<h2 id="구성요소"><a href="#구성요소" class="headerlink" title="구성요소"></a>구성요소</h2><ul>
<li>사용자(Resource Owner) : Service Provider에 계정을 가지고 있으면서, Client를 이용하려는 사용자</li>
<li>소비자(Client) : OAuth 인증을 사용해 Service Provider의 기능을 사용하려는 애플리케이션이나 웹 서비스</li>
<li>API 서버(Resource Server) : OAuth를 사용하는 Open API를 제공하는 서비스</li>
<li>권한 (Authroization Server) : OAuth 인증 서버</li>
<li>접근 토큰(Access Token) : 인증 후 Client가 Resource Server의 자원에 접근하기 위한 키를 포함한 값</li>
<li>갱신 토큰(Refresh Token) : 유효기간이 지난 Access Token을 갱신하기 위해 사용되는 값</li>
</ul>
<h2 id="인증과정"><a href="#인증과정" class="headerlink" title="인증과정"></a>인증과정</h2><p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fnn3785mw7j31460ro435.jpg" alt="OAuth 2.0 과정"></p>
<hr>
<h2 id="네이버-아이디로-로그인"><a href="#네이버-아이디로-로그인" class="headerlink" title="네이버 아이디로 로그인"></a>네이버 아이디로 로그인</h2><p><strong><code>&lt;네이버 아이디로 로그인&gt;</code>은 OAuth 2.0 기반의 사용자 인증 기능을 제공해 네이버가 아닌 다른 서비스에서 네이버의 사용자 인증 기능을 이용할 수 있게 하는 서비스입니다.</strong> 별도의 아이디나 비밀번호를 기억할 필요 없이 네이버 아이디로 간편하고 안전하게 서비스에 로그인할 수 있어, 가입이 귀찮거나 가입한 계정이 생각나지 않아 서비스를 이탈하는 사용자를 잡을 수 있습니다.</p>
<p>&lt;네이버 아이디로 로그인&gt;을 통해 로그인하는 기본 절차는 다음과 같습니다.</p>
<ol>
<li>로그인 (네이버 앱이 설치되어 있다면 네이버 앱의 간편 로그인 기능으로 로그인, 네이버 앱이 설치되지 않았다면 애플리케이션에서 인앱 브라우저가 실행되고 네이버 로그인 화면으로 이동한다.)</li>
<li>사용자가 네이버 아이디로 로그인하면 사용자 정보에 동의하는 화면으로 이동한다.</li>
<li>사용자가 정보 제공에 동의하면 <strong>콜백 URL로 애플리케이션에 <code>접근 토큰(access token)</code>이 발급된다.</strong> 발급받은 접근 토큰을 이용해 OAuth 2.0을 지원하는 네이버의 오픈 API를 사용하거나 사용자의 정보를 얻어 올 수 있다.</li>
</ol>
<h2 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h2><p>네이버 아이디로 로그인한 사용자의 이름, 메일 주소, 별명, 프로필 사진, 생일, 연령대, 성별 등을 API로 간단하게 조회할 수 있습니다.</p>
<h2 id="적용-칠자"><a href="#적용-칠자" class="headerlink" title="적용 칠자"></a>적용 칠자</h2><ol>
<li>애플리케이션 등록<br>네이버 아이디로 로그인을 적용하기 위해 애플리케이션을 등록하고 <strong>클라이언트 아이디와 클라이언트 시크릿 키</strong>를 발급받는다.</li>
<li>애플리케이션 개발<br>네이버 아이디로 로그인을 이용하기 위한 정보를 확인하고 등록한 환경에 맞는 개발가이드를 참고해 애플리케이션을 개발한다.<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.naver.com/docs/login/android/">- Android 튜토리얼 참고</a></li>
<li>서비스 적용<br>개발을 완료하면 서비스에 네이버 아이디로 로그인을 적용한다.</li>
</ol>
<h2 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h2><p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fnn43ymkojj30u01hcdhh.jpg" alt="네이버 아이디로 로그인 전"><br><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fnn449h4vyj30u01hcdif.jpg" alt="네이버 아이디로 로그인 후"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2017-08-11T09:00:00.000Z" title="8/11/2017, 6:00:00 PM">2017-08-11</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:34.430Z" title="3/21/2021, 8:06:34 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a><span> / </span><a class="link-muted" href="/categories/Programming/Node/">Node</a></span><span class="level-item">14분안에 읽기 (약 2148 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/08/11/Node/check-in-app-billing-purchase-validation/">Android In-App Purchase Validation</a></h1><div class="content"><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#1">어떤 문제가 발생했는가?</a></li>
<li><a href="#2">Subscriptions and In-App Purchases API</a></li>
<li><a href="#3">API 사용을 위한 서비스 계정 연결</a></li>
<li><a href="#4">API 사용하기 (With node-iap)</a></li>
<li><a href="#5">마치며</a></li>
</ol>
<hr>
<p>얼마전 아랍어 번역을 마치고 몇개 국가에 앱을 출시하게 되면서 <strong><code>결제 관련</code></strong> 문제가 발생하기 시작했습니다. 앱과 서버의 결제 관련 코드를 모두 제가 맡아 작성했기 때문에 계속해서 발생하는 문제로 인해 정신적 충격이 상당했습니다…</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://theeye.pe.kr/archives/2130">“Android In-App Billing 보안 완벽 정리”</a>의 글을 참고해 결국에는 앱내 구매(In-App Billing)시 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://in-appstore.com/android/">프리덤(Freedom)</a>과 같은 **<code>결제 해킹 앱</code>**에 의해 문제가 발생하게 된다는것을 알게 되었습니다.</p>
<p>이에 서버에서 **<code>In-App Purchase Validation(앱내 구매 유효성 검사)</code>**을 하는 코드를 추가했고 위의 문제를 해결할 수 있었습니다. 이번 포스팅에서는 <strong>In-App Purchase Validation</strong>에 대해서 알아보겠습니다. (In-App 결제 구현에 대한 내용은 다루지 않습니다!)</p>
<hr>
<span id="1">
## 1. 어떤 문제가 발생했는가?

<p>어느날 이상한일이 벌어졌다. 분명 Admin을 통해 앱에서 결제한 내용을 확인했을때는 상당한 내역이 있었는데, <strong>Google Play Console의 주문 관리</strong>를 통해 확인했을 때는 결제 내역이 없는 것이다.</p>
<p>결제 관련된 부분에서 버그가 발생했기에 무척이나 마음이 심란했다. 반복되는 테스트에서도 재현할 수 없는 현상에 라이브 채팅을 통해 Google에 문의하였지만 돌아오는 답변은 사용자의 결제 관련 설정(예를들면 카드)이 잘못되어 있을 것이라는 말뿐, 정확한 해결 방법을 알려주지 않았다.</p>
<p>그러던 도중 결제 관련 DB를 살펴보다가 이상한 부분을 발견했다.</p>
<p><img src="/images/post/2017-08-11/purchase_log.jpg" alt="비정상적인 연속된 결제 내역"></p>
<p>**한명의 사람이 말도 안되는 짧은 시간에 한 품목을 여러변 결제한 것이다. 그리고 이 결제 관련 내용은 Google Play Console의 주문 관리에서도 확인이 불가능했다. (기록이 남지 않았다.) **</p>
<p>결국 글의 도입부에서 말씀드렸던 것처럼 결제 해킹 문제임을 알게되었고 In-App Purchase Validation에 대해 알아보게 되었습니다.</p>
<hr>
<span id="2">
## 2. Subscriptions and In-App Purchases API

<p>Google에서는 **<code>Subscriptions and In-App Purchases API</code>**를 제공하고 있습니다. (전에는 이 API를 “Purchase Status API” 라고 불렀습니다.)</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.android.com/google/play/developer-api.html?hl=ko#subscriptions_api_overview">Document</a>를 참고하면 해당 API를 <strong>인앱 상품과 구독으로 구성된 앱의 카탈로그를 관리할 수 있으며, 개별 구매에 대한 정보, 구매와 구독의 만료 확인 등, 여러 가지 용도로 사용할 수 있음을 알 수 있습니다.</strong></p>
<p>따라서 실제 결제가 이루어졌고, Google Play Console의 주문 관리에 그 내역이 있는지 확인이 가능한 것입니다. 해당 API는 Google Play Developer API로서 허용되는 사용 할당량이 <strong>매일 200,000개의 요청</strong>으로 제한됩니다. 이 정도면 충분한 구독, 결제 유효성 검사 요구를 충족시킬 수 있으며, 만약 더 많은 요청이 필요하다면 Google Developer Console에서 요청할 수 있다고 합니다.</p>
<hr>
<span id="3">
## 3. API 사용을 위한 서비스 계정 연결

<p>API를 사용하기 위해서는 Google Developer Console에서 서비스 계정을 생성한 후 API 엑세스 권한을 부여해주어야 합니다. 몇가지 단계를 거쳐야 하는데 같이 해보겠습니다.</p>
<p>1.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://play.google.com/apps/publish/?hl=ko">Google Play Console</a>에 <strong>관리자 계정</strong>으로 로그인합니다.</p>
<p>2.<strong>설정 - API 액세스</strong>로 이동합니다. (서비스 약관은 수락합니다.)<br><img src="/images/post/2017-08-11/1.jpg"></p>
<p>3.<strong>새 프로젝트 만들기</strong> 후 하단의 <strong>서비스 계정 만들기</strong>를 선택합니다.<br><img src="/images/post/2017-08-11/2.jpg"></p>
<p>4.<strong>Google API 콘솔</strong>로 이동합니다.<br><img src="/images/post/2017-08-11/3.jpg"></p>
<p>5.<strong>서비스 계정 만들기</strong>를 선택한 후 다음과 같이 내용을 입력합니다.<br><img src="/images/post/2017-08-11/4.jpg"></p>
<p>6.서비스 계정을 생성하면 자동으로 <strong>.json 파일</strong>이 다운로드 됩니다. <strong>.json 파일에는 API 호출을 위한 인증 정보가 포함되어 있습니다. 관리 및 백업이 필요합니다.</strong></p>
<p>7.Google Play Console로 돌아와, 완료 버튼을 클릭한 후 서비스 계정이 생성되었는지 확인합니다.</p>
<p>8.<strong>엑세스 권한 부여</strong>를 클릭합니다.<br><img src="/images/post/2017-08-11/5.jpg"></p>
<p>9.역할을 <strong>금융</strong>으로 선택한 후, <strong>재무 데이터 보기</strong> 권한을 설정합니다.<br>(구매내역 및 영수증 검증을 하기 위해서는 재무 보고서 보기 권한이 필요합니다 . 역할을 금융으로 선택해 주면 해당 권한이 자동으로 선택됩니다. 영수증 검증을 위해서는 금융 역할을 갖는 서비스 계정이 필요합니다.)<br><img src="/images/post/2017-08-11/6.jpg"></p>
<hr>
<span id="4">
## 4. API 사용하기 (With node-iap)
복잡하게 토큰을 관리하며 HTTP/REST API를 사용할것 없이 **Google은 다양한 언어에 맞게 Client 라이브러리를 제공**하고 있습니다. [Access Google APIs more easily](https://developers.google.com/api-client-library/)를 통해서 다양한 언어의 라이브러리를 찾아 사용할 수 있습니다.

<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/google/google-api-nodejs-client/#google-apis-nodejs-client">google-api-nodejs-client</a>를 사용하면 되지만, **다른 Platform(apple)**에도 대응할 수 있는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Wizcorp/node-iap">node-iap(In-app purchase verification for Apple App Store and Google Play)</a>를 사용하겠습니다.</p>
<p>사용방법은 생각보다 정말 간단합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iap = <span class="built_in">require</span>(<span class="string">&#x27;iap&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> platform = <span class="string">&#x27;google&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> payment = &#123;</span><br><span class="line">	receipt: <span class="string">&#x27;receipt data&#x27;</span>, <span class="comment">// always required (purchaseToken)</span></span><br><span class="line">	productId: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">	packageName: <span class="string">&#x27;my.app&#x27;</span>,</span><br><span class="line">	keyObject: <span class="string">&#x27;&#x27;</span>, <span class="comment">// always required (user auth key)</span></span><br><span class="line">	subscription: <span class="literal">false</span>,	<span class="comment">// optional, if google play subscription</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">iap.verifyPayment(platform, payment, <span class="function"><span class="keyword">function</span> (<span class="params">error, response</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/* your code */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>node-iap는 google과 apple에서 모두 사용가능하기 때문에 platform을 명시해야 합니다. payment에는 확인하고자 하는 인앱결제 내역을 넣습니다.</p>
<p>Android In-App 결제를 하고나면 **<code>purchaseToken</code>**과 **<code>productId</code>**를 알 수 있습니다. payment의 receipt에는 purchaseToken 값을 넣습니다. productId와 packageName을 넣고 **<code>KeyObject</code>**에는 좀전에 사용자 계정을 추가하면서 다운로드 받았던 <strong>.json 파일</strong>의 값을 넣어주면 됩니다. (require 혹은 import하여 그대로 넣어주면 됩니다.)</p>
<p>Android 단말을 통해 테스트 결제 후 iap를 통해 purchase validation을 하면 다음과 같은 response를 얻을 수 있습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;receipt&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;androidpublisher#productPurchase&quot;</span>,</span><br><span class="line">                <span class="string">&quot;purchaseTimeMillis&quot;</span>: <span class="string">&quot;1410835105408&quot;</span>,</span><br><span class="line">                <span class="string">&quot;purchaseState&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;consumptionState&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;developerPayload&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;transactionId&quot;</span>: <span class="string">&quot;ghbbkjheodjokkipdmlkjajn.AO-J1OwfrtpJd2fkzzZqv7i107yPmaUD9Vauf9g5evoqbIVzdOGYyJTSEMhSTGFkCOzGtWccxe17dtbS1c16M2OryJZPJ3z-eYhEJYiSLHxEZLnUJ8yfBmI&quot;</span>,</span><br><span class="line">        <span class="string">&quot;productId&quot;</span>: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;platform&quot;</span>: <span class="string">&quot;google&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>여기서 중요한 부분은 **<code>purchaseState</code>**의 값이 **<code>0</code>**이면 <strong>결제가 완료</strong>된 상태를 뜻하며 **<code>1</code>**이면 <strong>환불이 완료</strong>된 상태를 의미합니다.</p>
<p>만약 사용자가 제대로 된 결제를 하지 않는다면 purchaseToken 값은 유효하지 않아 purchase validation 과정에서 err가 발생할 것입니다.</p>
<hr>
<span id="5">
## 5. 마치며
굉장히 큰 문제라고 생각했지만 생각보다 조치하는 과정에 있어서 큰 어려움은 없었습니다. 아직 제가 더 생각하지 못한 부분이 있을수도 있을거라 생각합니다. 혹시나 더 추가해야 하는 부분이 있다면 알려주세요!

<p>저는 추가적으로 가짜 결제를 시도하는 유저들의 로그를 DB에 남기고 자동으로 block 처리를 해 게임을 못하도록 막았습니다. purchase validation 구현 후 바로 다음날 다시 또 가짜 결제가 이루어졌는데 유효성 검사가 제대로 이루어지는 것을 보고 정말 다행이라 생각했습니다.</p>
<p>제가 지금까지 회사에서 일하며 발생했던 가장 크리티컬했던 부분이라고 생각하는데 혹시나 이 글을 읽으시는 분중 아직 purchase validation을 하지 않고 계시다면 지금이라도 꼭 코드를 추가하셨으면 합니다.</p>
<hr>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.android.com/google/play/developer-api.html?hl=ko">Google Play Developer API</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://theeye.pe.kr/archives/2130">Android In-App Billing 보안 완벽 정리</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://theeye.pe.kr/archives/tag/purchasestate">Android In-App Billing 서버사이드 보안 완벽 정리</a></li>
</ul>
</span></span></span></span></span></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2017-07-31T15:00:00.000Z" title="8/1/2017, 12:00:00 AM">2017-08-01</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:48.468Z" title="3/21/2021, 8:06:48 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">8분안에 읽기 (약 1273 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/08/01/Programming/5th-uniton/">Uniton 후기</a></h1><div class="content"><p><img src="/images/post/2017-08-01/bg.png"></p>
<p><strong>2017.07.28(금) ~ 07.30(일) 2박3일간 유니톤에 참여</strong>했습니다. 아래의 사진에서 볼 수 있듯이, 이번 **<code>유니톤</code>**은 <strong>UNIT, NEXTERS, REAL, YAPP</strong> 4개의 연합 IT 단체에서 주관하고 있습니다. </p>
<p><img src="/images/post/2017-08-01/introduce.png" alt="유니톤 주최 연합 IT 단체"></p>
<p>여러 기업의 후원을 받으며 각 IT 단체의 학생들이 모여 진행하는 모습이 멋있었습니다. 어떠한 이익을 추구하지 않으며 자신들이 재밌게 즐겼던 이 유니톤 행사가 계속 이어지길 바라는 마음을 갖고 있으셔서 인지 2박3일간 관리하느라 그 어떤 사람들보다 힘들었을 텐데 다들 즐거워 보이셨습니다. 먼저 유니톤 행사를 잘 진행해주셔서 감사합니다!</p>
<p>해커톤이나 유니톤에 참여하는건 이번이 처음이었습니다. 2월에 졸업하고 지금은 직장인이지만 이전에 **<code>SOPT</code>**에서 동아리 활동했던 경험이 있기에 신청을 했는데 운이좋게 참여할 수 있게되었습니다.</p>
<p>이번 유니톤의 전체적인 행사는 다음과 같았습니다.</p>
<p><img src="/images/post/2017-08-01/poster.png" alt="행사 일정"></p>
<p>먼저 2박3일간의 유니톤을 진행하기 일주일 전 **<code>네트워킹 데이</code>**를 통해서 유니톤에서 활용 가능한 후원사들의 서비스와 기술들을 세미나를 통해 배우고 심화시킬 수 있는 시간을 가졌습니다. 저는 회사 일로 인해 참여할 수 없어 아쉬웠지만, 세미나 뿐만 아니라 여러 이벤트도 하며 선물도 나눠주는 시간이였다고 합니다. 네트워킹 데이는 유니톤에 참여하지 않는 분들도 참여할 수 있다고 합니다. (다음에는 꼭 참여해보겠습니다!)</p>
<p>그렇게 네트워킹 데이가 끝나고 일주일 후에 본격적인 유니톤이 시작됩니다! 장소는 공덕역 근처의 <strong><code>서울창업허브</code></strong> 였는데, 시설이 매우매우 좋았습니다.</p>
<p><img src="/images/post/2017-08-01/seoul-hub.jpg" alt="서울창업허브"></p>
<p><strong>약 100명정도의 참가자</strong>가 미리 정해진 조에 따라 모여 사전 행사 (세미나, 후원사 대표자 분들과 네트워킹)를 가진 후 <strong>아이디어 회의</strong>를 시작합니다. 사실 시작하기전 사전 행사가 매우 길었는데… 후원을 받는만큼 어쩔 수 없다고 생각합니다. 그래도 AWS 크래딧, 개발 서적, 목배게 등 여려가지 선물을 많이 받아서 좋았습니다!</p>
<p>사전행사를 하며 여러가지 팀게임을 하고 선물도 받으니 조금은 어색한게 풀려 여러가지 아이디어 회의를 했습니다. 오히려 주제가 정해지지 않고 자유이다 보니 아이디어를 정해는데 애먹긴했지만, 대부분 다른조와 마찬가지로 첫날(금요일)은 아이디어 주제를 정한 후 각자 집으로 갔습니다.</p>
<p><strong>둘째날!!</strong> 저희 조는 11시에 모여 첫날 다하지 못한 아이디어 회의를 마무리 한 후 바로 개발과 디자인을 시작했습니다. <strong>개발자(안드로이드3, 서버2)5명, 디자인 1명</strong>으로 구성되었고 저는 서버 개발로 참여했으나, 구현하고자 하는 앱은 서버 개발보다는 프론트에서 해야할 일이 훨씬 많았기에 프론트를 개발하게되었습니다.</p>
<p>그간 회사에서 사용했던 **<code>ReactNative</code>**에 미리 만들어 놓은 <strong>boilerplate</strong>를 사용해서 개발했습니다. 정말 잠 한숨 안자며 죽어라 개발했지만 원래 계획했던 것중 한개의 엑티비티를 완성하지 못했지만, 그래도 만족할만큼 개발한것 같습니다.</p>
<p>간단하게 앱에 대해 설명하면, <strong>한국관광공사</strong>에서 제공하는 **<code>Tour Api 3.0</code>**을 사용해 <strong>지역기반의 여행 정보를 제공하는 앱</strong>을 만들었습니다. 다음은 안성된 앱의 엑티비티 입니다.</p>
<p><img src="/images/post/2017-08-01/app_1.png" alt="App 설명 - 1"><br><img src="/images/post/2017-08-01/app_2.png" alt="App 설명 - 2"></p>
<p><strong>발표자료와 서버, 클라이언트 코드</strong>는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/jongmin92/UNITHON-5TH">UNITON-5TH</a> Git-Hub 에서 확인 가능합니다.</p>
<p>비록 수상은 못해 조금은 아쉽지만 간만에 오랜시간 집중해 즐겁게 코딩한건 오랜만인것 같습니다. 팀원들과도 더 친해졌으면 좋았겠지만 개발하기에도 짧은 시간이 아쉬웠습니다. 다음 UNITON에도 참여할 것이며, 종종 다른 해커톤과 같은 행사가 있으면 참여할 생각입니다.</p>
<p>마지막으로 단체사진 투척하며 UNITON에 참여하신 모든분들 고생하셨습니다!</p>
<p><img src="/images/post/2017-08-01/photo.jpg" alt="UNITON 단체사진"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2017-07-19T15:00:00.000Z" title="7/20/2017, 12:00:00 AM">2017-07-20</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:07:41.375Z" title="3/21/2021, 8:07:41 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a><span> / </span><a class="link-muted" href="/categories/Programming/React-Native/">React Native</a></span><span class="level-item">26분안에 읽기 (약 3907 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/07/20/ReactNative/create-react-native-app/">create-react-native-app (crna) 사용하기</a></h1><div class="content"><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#1">들어가며</a></li>
<li><a href="#2">create-react-native-app (crna)란?</a></li>
<li><a href="#3">CRNA 프로젝트 생성</a></li>
<li><a href="#4">CRNA 프로젝트 실행 - 1 (With 모바일 Expo 앱)</a></li>
<li><a href="#5">CRNA 프로젝트 실행 - 2 (With 데스크탑 Expo Tool (Expo XDE))</a></li>
<li><a href="#6">CRNA 프로젝트 ejecting</a></li>
<li><a href="#7">Expo 라이브러리 사용해보기</a></li>
<li><a href="#8">마치며</a></li>
</ol>
<hr>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>회사에서 약 6개월간 React Native를 이용한 게임 앱(eyePoker - 화상채팅과 함께하는 포커게임) 개발을 마무리하였습니다. 후에 React Native를 사용해 새로운 앱을 개발할때 사용할 수 있도록 그간 React Native로 개발하면서 익힌 것들을 boilerplate로 만들려고 했습니다.</p>
<p>약 6개월전 처음 React Native를 접했을때 당시 <strong>v0.39</strong> 였으나 최근 확인해보니 <strong>stable 버전이 v0.46</strong> 까지 나와있었습니다. v0.46을 이용해 React Native 프로젝트를 생성하고자 하니 **<code>Create React Native App</code>**이 추가되어 있었습니다. (앞으로 Create React Native App을 **<code>CRNA</code>**라고 부르겠습니다.)</p>
<p><strong>CRNA</strong>는 기존의 <strong>React Native CLI</strong>를 이용하지 않고 프로젝트를 생성하는 방법입니다. 지금부터 CRNA에 대해 알아보고 기존의 React Native CLI를 사용해서 프로젝트를 생성할때와 어떤 다른점이 있는지 알아보도록 하겠습니다.</p>
<hr>
<h2 id="create-react-native-app-crna-란"><a href="#create-react-native-app-crna-란" class="headerlink" title="create-react-native-app (crna)란?"></a>create-react-native-app (crna)란?</h2><p>먼저 아래의 영상을 통해 CRNA를 통해 프로젝트를 생성하고 실행하는 과정을 볼 수 있습니다. 약 6분정도의 짧은 영상입니다. 간단하게 한번 보시면 뒤의 내용을 좀 더 쉽게 이해할 수 있습니다.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/9baaVjGdBqs" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<p><a target="_blank" rel="external nofollow noopener noreferrer" href="http://facebook.github.io/react-native/docs/getting-started.html">React Native Document</a>에서도 확인할 수 있듯이, <strong>CRNA는 React Native 프로젝트를 시작하기 훨씬 쉽게 해주는 도구입니다.</strong> React를 접해보신분은 한번쯤 들어보셨을 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/facebookincubator/create-react-app">React Create App</a>에서 영감을 받은 것이고, <strong>Expo</strong>라는 회사와 협업을 통해 만들어진 결과물 입니다.</p>
<p>Android나 iOS를 개발해본 경험 없이 React Native를 통해 앱 개발을 시작함에 있어서 네이티브 빌드에 필요한 도구를 설치하고 환경을 구성하는 것은 쉽지 않은 작업 입니다. <strong>그러나 CRNA를 사용하면 Xcode 또는 Android Studio가 필요없으며 Linux 또는 Windows를 사용하여 iOS 장치 용으로도 개발할 수 있습니다.</strong> (이제 Mac이 필수가 아닙니다…)</p>
<p>CRNA는 네이티브 코드를 컴파일하지 않고 순수 JavaScript로 작성된 CRNA 프로젝트를 로드하고 <strong>Expo 앱을 사용하여 실행</strong>합니다. 그렇기 때문에 CRNA를 사용해 프로젝트를 생성할 경우 <strong>기존 CLI를 사용해서 생성한 결과물과는 다르게 프로젝트 폴더에 android와 ios 폴더가 없습니다.</strong></p>
<p>그러나 아직 대부분의 React Native 라이브러리들을 사용하기 위해서는 android와 ios 폴더 아래 있는 네이티브 프로젝트 파일(Java, Objective-C, Swift)을 직접 수정하고 컴파일 해야하는 하는데 이러한 경우는 어떻게 할까요?</p>
<p>먼저, Expo는 이러한 경우를 대비해 카메라, 비디오, 연락처등 자주 사용되는 <strong>인기있는 라이브러리들을 번들로 제공</strong>하고 있습니다. 그렇기 때문에 대부분의 간단한 앱들은 따로 외부 라이브러리를 추가하지 않아도 만들 수 있습니다. 그러나 번들로 제공되지 않는 기능이 필요해 라이브러리를 추가해야하는 경우, 네이티브 코드 추가 및 빌드가 필요하기 때문에 CRNA를 사용해 생성한 프로젝트를 그대로 사용할 수가 없습니다. 이러한 경우를 대비해 Create React App에서 제공하는것과 마찬가지로 CRNA에서도 <strong><code>ejecting</code></strong> 기능을 제공하고 있습니다.</p>
<p><strong><code>npm run eject</code></strong> 명령어를 통해 CLI를 통해 프로젝트를 생성한 것과 유사한 프로젝트를 얻을 수 있습니다. android와 ios 프로젝트 폴더가 생성됩니다. 그렇기 때문에 네이티브 빌드를 하기 위해서는 Xcode 또는 Android Studio가 필요합니다.</p>
<hr>
<h2 id="CRNA-프로젝트-생성"><a href="#CRNA-프로젝트-생성" class="headerlink" title="CRNA 프로젝트 생성"></a>CRNA 프로젝트 생성</h2><blockquote>
<p>저는 nvm을 통해서 <strong>node v8.1.4, npm v4.6.1</strong>을 사용하고 있습니다. (npm은 v5.x대의 경우 에러가 발생하기 때문에 v4.x로 재설치를 하고 진행하셔야 합니다.)</p>
</blockquote>
<p>이제 CRNA를 사용해서 프로젝트를 생성해보겠습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g create-react-native-app</span><br><span class="line">$ create-react-native-app crna-project</span><br><span class="line">$ cd crna-project</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>

<p>**<code>CRNA</code>**를 사용해 프로젝트를 생성한 결과 구조는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">crna-project</span><br><span class="line">    ├── App.js</span><br><span class="line">    ├── App.test.js</span><br><span class="line">    ├── app.json</span><br><span class="line">    ├── node_modules&#x2F;</span><br><span class="line">    ├── package.json</span><br><span class="line">    ├── yarn.lock</span><br><span class="line">    └── README.md</span><br></pre></td></tr></table></figure>

<p>참고) **<code>CLI</code>**를 생성해 프로젝트를 생성한 결과는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli-project</span><br><span class="line">    ├── index.android.js</span><br><span class="line">    ├── index.ios.js</span><br><span class="line">    ├── android&#x2F;</span><br><span class="line">    ├── ios&#x2F;</span><br><span class="line">    ├── node_modules&#x2F;</span><br><span class="line">    ├── __tests__&#x2F;</span><br><span class="line">    ├── app.json</span><br><span class="line">    ├── package-lock.json</span><br><span class="line">    ├── package.json</span><br><span class="line">    └── yarn.lock</span><br></pre></td></tr></table></figure>

<p>기존 CLI를 사용했을때와 다르게 <strong>index.android.js와 index.ios.js는 App.js로 변경</strong>되었으며, 네이티브 빌드에 사용되는 <strong>android, ios 폴더</strong>는 사라졌습니다. 또한 app.json 파일은 그대로 존재하지만 파일 내용에는 차이가 있습니다.</p>
<p>**<code>CRNA</code>**를 사용해 생성한 프로젝트의 app.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;expo&quot;: &#123;</span><br><span class="line">    &quot;sdkVersion&quot;: &quot;18.0.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**<code>CLI</code>**를 사용해 생성한 프로젝트의 app.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;cli-project&quot;,</span><br><span class="line">  &quot;displayName&quot;: &quot;cli-project&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CRNA를 사용해 생성한 프로젝트의 <strong>app.json</strong>은 expo의 sdkVersion을 표시하고 있습니다.</p>
<hr>
<h2 id="CRNA-프로젝트-실행-1-With-모바일-Expo-앱"><a href="#CRNA-프로젝트-실행-1-With-모바일-Expo-앱" class="headerlink" title="CRNA 프로젝트 실행 - 1 (With 모바일 Expo 앱)"></a>CRNA 프로젝트 실행 - 1 (With 모바일 Expo 앱)</h2><p>이제 생성한 CRNA 프로젝트를 실행해 보겠습니다. 기존 CLI를 통해 프로젝트를 생성했을 때는 실행을 위해 Android SDK와 Xcode가 필요하였고 다음의 명령어로 네이티브 빌드를 하여 실행했습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ react-native run-android</span><br><span class="line">$ react-native run-ios</span><br></pre></td></tr></table></figure>

<p>그러나 CRNA를 사용해 생성한 프로젝트는 다음의 명령어로 실행합니다. 명령어를 실행하면 다음과 같은 QR코드가 출력됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<p><img src="/images/post/2017-07-20/crna-npm-start.png" alt="crna 프로젝트를 실행한 결과"></p>
<p>QR코드가 출력되어 당황할 수 있지만 이 QR코드를 통해서 방금 생성한 프로젝트를 실행할 수 있습니다. 처음에 말씀드렸다시피 CRNA는 네이티브 코드를 컴파일하지 않고 순수 JavaScript로 작성된 CRNA 프로젝트를 로드하고 <strong>Expo 앱을 사용하여 실행</strong>한다고 했습니다. 그렇기 때문에 저희가 실행 결과를 확인하기 위해서는 Expo 앱을 추가로 설치해야합니다.</p>
<p>Expo앱은 JavaScript를 작성하여 기본 iOS 및 Android 앱을 제작할 수있게 해주는 도구, 라이브러리 및 서비스 세트이며 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://expo.io/">Expo앱 다운로드</a>를 통해서 다운로드 후 설치 합니다.</p>
<p>다운로드 후 Expo앱을 실행하고 QR코드를 입력하면 다음과 같이 앱이 실행됩니다.</p>
<p><img src="/images/post/2017-07-20/expo_app_run1.png" alt="Expo 앱을 통한 CRNA 프로젝트 실행 - 1"><br><img src="/images/post/2017-07-20/expo_app_run2.png" alt="Expo 앱을 통한 CRNA 프로젝트 실행 - 2"></p>
<p>CLI를 통해 생성한 프로젝트를 실행하여 가상머신을 통해 결과를 확인했을 때와 같이 동일한 결과를 얻을 수 있습니다.</p>
<hr>
<h2 id="CRNA-프로젝트-실행-2-With-데스크탑-Expo-Tool-Expo-XDE"><a href="#CRNA-프로젝트-실행-2-With-데스크탑-Expo-Tool-Expo-XDE" class="headerlink" title="CRNA 프로젝트 실행 - 2 (With 데스크탑 Expo Tool (Expo XDE))"></a>CRNA 프로젝트 실행 - 2 (With 데스크탑 Expo Tool (Expo XDE))</h2><p>조금 전에는 Expo 앱과 CRNA를 실행한 후 QR코드를 통해 자신의 모바일에서 결과를 확인했습니다. 이번에는 모바일 앱이 아닌 Expo XDE를 설치한 후 가상머신을 통해 실행해 보도록 하겠습니다. Expo XDE를 실행한 후 조금전 생성한 CRNA 프로젝트를 로드합니다.<br>(Expo XDE를 설치하면서 에러가 발생하시는 분은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.expo.io/versions/v15.0.0/introduction/installation.html">Expo Installation</a>을 참고해서 Expo XDE에 필요한 다른 도구들을 설치해야합니다.)</p>
<p><img src="/images/post/2017-07-20/expo_load_crna_project.png" alt="Expo XDE로 CRNA 프로젝트 로드"></p>
<p>프로젝트가 로드되면 우측 상단의 <strong><code>Share</code></strong> 버튼을 통해 조금전 npm start에서 제공했던것과 동일하게 QR코드를 제공받아 모바일 Expo 앱에서 프로젝트를 실행할 수 있고, <strong><code>Device</code></strong> 버튼은 현재 데스크탑에 설치되어 있는 iOS, Android 가상머신을 통해 실행할 수 있습니다.</p>
<p>이외에도 Expo XDE의 기능은 여러가지가 있습니다. 이외의 기능들은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.expo.io/versions/v19.0.0/index.html">Expo Documentation &amp; Guides</a>에서 확인할 수 있습니다.</p>
<hr>
<h2 id="CRNA-프로젝트-ejecting"><a href="#CRNA-프로젝트-ejecting" class="headerlink" title="CRNA 프로젝트 ejecting"></a>CRNA 프로젝트 ejecting</h2><p>지금까지 CRNA를 통해 프로젝트를 생성하고 실행해 보았습니다. 마지막으로 <strong><code>ejecting</code></strong> 기능에 대해서 알아보겠습니다. CRNA의 ejecting 기능은 번들로 제공되지 않는 기능이 필요해 <strong>라이브러리를 추가해야하는 경우 네이티브 코드 추가 및 빌드가 필요하기 때문에</strong> CRNA를 사용해 생성한 프로젝트를 그대로 사용할 수가 없으므로 사용하게됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run eject</span><br></pre></td></tr></table></figure>

<p><img src="/images/post/2017-07-20/eject1.png" alt="CRNA - eject 옵션 선택"></p>
<p><strong>eject 기능을 실행하면 2가지 옵션중 하나를 선택</strong>하게 됩니다. 1) CLI로 생성한 프로젝트와 같은 모양을 같는 프로젝트로 변경할 것인지, 2) 인기있는 라이브러리이 포함된 ExpoKit을 그대로 사용하며 android, ios 와 같은 네이티브 폴더를 eject 할 것인지 선택하게 됩니다.</p>
<p><strong>ExpoKit 옵션을 선택하여 ExpoKit은 그대로 사용할 수 있도록 유지</strong>합니다. Expokit 옵션을 선택하게 되면 iOS bundle identifier등 Android의 package name을 설정하게 되는데, 이때 주의해야할 점은 package name을 올바르지 않게 설정하게 되면 후에 네이티브 컴파일에서 오류가 생기게 됩니다. 이를 다시 수정하는건 번거로운 일이니 처음 설정시 신중하게 설정해야합니다. (‘-‘나 ‘_’와 같은 문자 대신 ‘.’을 이용해 패키지 명을 작성합니다.)</p>
<p><img src="/images/post/2017-07-20/eject2.png" alt="CRNA - eject 설정 사항"></p>
<p>crna 프로젝트를 eject하고 난 후에는 다음과 같이 폴더 구조가 변경됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">crna-project (eject with ExpoKit)</span><br><span class="line">    ├── App.js</span><br><span class="line">    ├── App.test.js</span><br><span class="line">    ├── app.json</span><br><span class="line">    ├── android&#x2F;</span><br><span class="line">    ├── ios&#x2F;</span><br><span class="line">    ├── node_modules&#x2F;</span><br><span class="line">    ├── .expo</span><br><span class="line">    ├── .expo-source&#x2F;</span><br><span class="line">    ├── package.json</span><br><span class="line">    ├── yarn.lock</span><br><span class="line">    └── README.md</span><br></pre></td></tr></table></figure>

<p>이제 네이티브 관련 코드가 생성되었기 때문에 react-native-cli 명령어들을 사용할 수 있습니다. 그러나 react-native run-ios 명령어를 통해 실행을 하게되면 에러가 발생합니다. 이는 eject후 expo관련 모듈을 네이티브(ios) 폴더 아래에서 다시 설치해줘야하기 때문입니다. ios 폴더 아래에서 다음의 명령어를 실행합니다. (CocoaPods이 없으신 분들은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://cocoapods.org/">CocoaPods 홈페이지</a>를 참고하여 설치합니다.) 또한 node_module도 다시 설치해야 하기때문에 프로젝트 폴더 아래에서 npm install을 실행합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install &#x2F;&#x2F; 프로젝트 폴더 아래에서</span><br><span class="line">$ pod install &#x2F;&#x2F; 프로젝트폴더-ios 폴더 아래에서</span><br></pre></td></tr></table></figure>

<p><img src="/images/post/2017-07-20/eject3.png" alt="eject 후 Expo - ios 모듈 설치"></p>
<p>이제 react-native run-ios 명령어를 실행하면 가상머신을 통해 실행할 수 있습니다. 그러나 기존 CLI를 통해 생성한 프로젝트와 다르게 CRNA로 프로젝트를 생성한 후 eject 하여도 최초 CRNA로 프로젝트를 생성한 것이라면 Expo 혹은 exp(Expo Cli Tool)의 도구가 필요합니다. (React Native 프로젝트 실행시 Packager라는게 필요한데 CRNA로 프로젝트를 셍성했다면 Expo혹은 exp가 이 packager를 대신 실행하게 됩니다.)</p>
<p>그렇기 때문에 Expo를 실행하여 프로젝트를 로드하거나 새로운 터미널을 실행하여 exp start를 실행한 후 react-native run-ios를 실행하면 가상머신에서 프로젝트가 실행됩니다.</p>
<hr>
<h2 id="Expo-라이브러리-사용해보기"><a href="#Expo-라이브러리-사용해보기" class="headerlink" title="Expo 라이브러리 사용해보기"></a>Expo 라이브러리 사용해보기</h2><p><strong><code>Expo SDK</code>는 다양한 라이브러리를 제공</strong>하고 있습니다. 기본적으로 자주 쓰이고 필요한 라이브러리들은 다 있고, 관리가 잘 되고 있기 때문에 믿고 쓸 수 있습니다. 아직 그 수가 많지는 않지만 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://expo.canny.io/feature-requests">Feature-Request</a>에서 사용자와의 소통을 통해 지속적으로 라이브러리를 추가해가고 있습니다.</p>
<p>지금부터는 Expo SDK에 <strong>Lottie 라이브러리</strong>를 사용해 보겠습니다. <a target="_blank" rel="external nofollow noopener noreferrer" href="https://airbnb.design/lottie/">Lottie</a>는 Airbnb에서 만들어 제공하는 라이브러리로 iOS, Android, React Native에서 After Effects로 만든 애니메이션을 실시간으로 앱에서 정적 이미지를 사용하는 것처럼 쉽게 애니메이션을 사용할 수 있도록 도와줍니다.</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.expo.io/versions/v18.0.0/sdk/lottie.html">Expo Lottie Document</a>를 참고해서 Lottie 라이브러리를 사용하면 다음과 같은 간단히 테스트가 가능합니다.</p>
<p><img src="/images/post/2017-07-20/epxo-lottie-test.png" alt="Expo lottie 테스트"></p>
<p>기존의 CLI를 통해 프로젝트를 생성하고 Lottie를 사용해보신분들은 정말 과정이 간편해졌다는걸 느낄 수 있습니다. Expo SDK를 사용하지 않고 React Native 프로젝트에서 Lottie를 사용하기 위해서는 네이티브 코드에 Lottie관련 코드들을 추가하고 컴파일 과정에서 생기는 문제를 해결하기 위해서 많은 시간이 필요했습니다. (<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/airbnb/lottie-react-native">React Native Lottie - Github</a>을 참고해보세요) 그러나 Expo SDK를 사용하면 정말 간단한게 사용할 수 있게 되었습니다.</p>
<hr>
<h2 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h2><p>새롭게 추가된 <strong>CRNA</strong>는 React Native에 있어서 큰 변화라고 생각합니다. 아직은 Expo SDK에서 제공하는 라이브러리가 많지 않기 때문에 ejecting이 불가피하지만 Expo의 지속적인 관리로 앞으로 더 많은 라이브러리들과 기능들이 추가되고 점점 사용하기 쉽고 편하게 바뀔것이라 생각됩니다.</p>
<p>앞으로 새롭게 시작하는 React Native 프로젝트는 CLI보다는 CRNA를 통해서 프로젝트를 시작한 후 ejecting 기능을 사용해 Expo SDK를 그대로 가져가며 프로젝트는 진행하는것이 좋을것 같습니다.</p>
<p>추가적으로 Expo에 대해서 더 궁금한게 있으신분은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.expo.io/versions/v18.0.0/introduction/faq.html">Expo-Frequently Asked Questions</a>를 참고하시면 될것 같습니다.</p>
<hr>
<h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://facebook.github.io/react-native/blog/2017/03/13/introducing-create-react-native-app.html">Introducing Create React Native App</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2017-07-13T09:43:00.000Z" title="7/13/2017, 6:43:00 PM">2017-07-13</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-03-21T11:06:43.447Z" title="3/21/2021, 8:06:43 PM">2021-03-21</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a><span> / </span><a class="link-muted" href="/categories/Programming/Node/">Node</a></span><span class="level-item">12분안에 읽기 (약 1861 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/07/13/Node/require/">require는 어떻게 동작할까?</a></h1><div class="content"><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#1">Node.js의 모듈 로딩 시스템</a></li>
<li><a href="#2">require가 갖는 문제점</a></li>
<li><a href="#3">대 / 소문자 구분</a></li>
<li><a href="#4">NPM 모듈 종속성</a></li>
<li><a href="#5">마치며</a></li>
</ol>
<hr>
<p>Node.js를 사용하며 문득 require에 대해 궁금증이 생겼습니다. 대부분 자주 사용하는 코드를 모듈 형식으로 만들어 **<code>module.exports</code>**를 사용해서 객체 인스턴스를 내보내고 이를 다른 파일에서 **<code>require</code>**를 통해서 사용하게 되는데 대부분 <strong>여러 파일</strong>에서 모듈을 <strong>require</strong>해 사용하게 됩니다. 이때 여러파일에서 중복되는 require는 계속해서 새로운 인스턴스를 생성하는지, 그게 아니라면 어떻게 동작되는지 궁금해서 공부하며 찾아본 내용을 포스팅합니다.</p>
<hr>
<span id="1">
## 1. Node.js의 모듈 로딩 시스템

<p>Node.js는 간단한 모듈 로딩 시스템을 갖고 있습니다. Node.js에서 <strong>파일과 모듈은 일대일로 대응하며 각 파일은 별도의 모듈로 처리됩니다.</strong> 그렇기 때문에 여러곳에서 하나의 파일에 작성된 모듈을 필요로 할때 동일한 인스턴스를 사용할 수 있도록 합니다.</p>
<p>즉, 모듈을 require할 때마다 새로운 인스턴스가 생성되는 것이 아니라 <strong>캐싱된 객체 인스턴스를 재사용</strong>하는 것 입니다.</p>
<p>Node.js 공식 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://nodejs.org/api/globals.html#globals_require">Documentation</a>에서 확인할 수 있듯이 한번 로딩(require)된 모듈은 **<code>require.cache</code>**라는 객체에 캐싱됩니다. key값으로 <strong>해당 모듈 파일의 경로</strong>를 갖게 되는데 key값이 삭제된다면 다음 require 요청시 다시 재로딩 하게됩니다. 다음 코드를 통해서 require.cache에 캐싱된 모듈을 확인해보겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  foo: <span class="string">&quot;bar&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">&#x27;./foo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---------- require.cache ----------&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">require</span>.cache);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---------- require.cache keys ----------&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(<span class="built_in">require</span>.cache));</span><br></pre></td></tr></table></figure>

<p>foo.js 와 index.js 파일을 통해 확인한 결과는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">kimjongmin:~&#x2F;work&#x2F;require_test $node index.js</span><br><span class="line"></span><br><span class="line">---------- require.cache ----------</span><br><span class="line">&#123; &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;index.js&#39;:</span><br><span class="line">   Module &#123;</span><br><span class="line">     id: &#39;.&#39;,</span><br><span class="line">     exports: &#123;&#125;,</span><br><span class="line">     parent: null,</span><br><span class="line">     filename: &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;index.js&#39;,</span><br><span class="line">     loaded: false,</span><br><span class="line">     children: [ [Object] ],</span><br><span class="line">     paths:</span><br><span class="line">      [ &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;node_modules&#39; ] &#125;,</span><br><span class="line">  &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;foo.js&#39;:</span><br><span class="line">   Module &#123;</span><br><span class="line">     id: &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;foo.js&#39;,</span><br><span class="line">     exports: &#123; foo: &#39;bar&#39; &#125;,</span><br><span class="line">     parent:</span><br><span class="line">      Module &#123;</span><br><span class="line">        id: &#39;.&#39;,</span><br><span class="line">        exports: &#123;&#125;,</span><br><span class="line">        parent: null,</span><br><span class="line">        filename: &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;index.js&#39;,</span><br><span class="line">        loaded: false,</span><br><span class="line">        children: [Object],</span><br><span class="line">        paths: [Object] &#125;,</span><br><span class="line">     filename: &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;foo.js&#39;,</span><br><span class="line">     loaded: true,</span><br><span class="line">     children: [],</span><br><span class="line">     paths:</span><br><span class="line">      [ &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;Users&#x2F;node_modules&#39;,</span><br><span class="line">        &#39;&#x2F;node_modules&#39; ] &#125; &#125;</span><br><span class="line">---------- require.cache keys ----------</span><br><span class="line">[ &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;index.js&#39;,</span><br><span class="line">  &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;foo.js&#39; ]</span><br></pre></td></tr></table></figure>

<p>위의 결과에서 확인할 수 있듯이 <strong><code>require.cache</code></strong> 객체는 key값으로 <strong>해당 모듈 파일의 경로</strong>를 사용해 모듈을 캐싱하고 있습니다.</p>
<hr>
<span id="2">
## 2. require가 갖는 문제점

<p>이제 require를 통해 모듈을 로딩할 경우 <strong>파일의 경로를 캐시 키로 사용</strong>하여 다른 여러 파일에서 동일한 파일을 필요로하는 경우 동일한 캐싱 된 모듈을 사용하는 것을 알게되었습니다.</p>
<p>이로인해 불필요한 메모리 사용을 피할 수 있습니다. 어찌보면 한번 로딩된 후 재사용되기 때문에 싱글 톤과 같이 동작한다고도 생각할 수 있습니다. 그러나 이러한 모듈의 캐싱 방식이 다음과 같이 제대로 동작하지 않는 경우가 있습니다.</p>
<ul>
<li>파일 이름의 잘못된 대 / 소문자 사용</li>
<li>다른 모듈이 NPM에서 동일한 모듈을 설치할 때</li>
</ul>
<hr>
<span id="3">
## 3. 대 / 소문자 구분

<p><strong>Windows 및 macOS는 기본적으로 파일 시스템에서 대 / 소문자를 구분하지 않습니다.</strong> 따라서 “foo.js” 라는 파일과 “FOO.js” 라는 파일을 검색 할 경우, 이 두 검색은 실제 파일 이름의 대소 문자와 상관없이 같은 폴더에서 동일한 파일을 찾습니다.</p>
<p>그러나 <strong>Node.js에서는 대/ 소문자를 구별하기 때문에 파일 이름을 두 개의 개별 모듈로 취급</strong>하므로 “foo.js”와 “FOO.js”가 같은 파일이라는 것을 알지 못합니다.</p>
<p>이 때문에 Windows와 macOS 모두에서 require 호출의 객체 캐시를 쉽게 파기 할 수 있습니다. 다음의 예시 코드에서 쉽게 확인할 수 있습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  foo: <span class="string">&quot;bar&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">&#x27;./foo&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> FOO = <span class="built_in">require</span>(<span class="string">&#x27;./FOO&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---------- require.cache keys ----------&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(<span class="built_in">require</span>.cache));</span><br><span class="line"></span><br><span class="line">FOO.foo = <span class="string">&#x27;different bar&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---- foo object ----&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(foo, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---- FOO object ----&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(FOO, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;---- foo object ----&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(foo, <span class="literal">null</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>결과는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kimjongmin:~&#x2F;work&#x2F;require_test $node index.js</span><br><span class="line"></span><br><span class="line">---------- require.cache keys ----------</span><br><span class="line">[ &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;index.js&#39;,</span><br><span class="line">  &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;foo.js&#39;,</span><br><span class="line">  &#39;&#x2F;Users&#x2F;kimjongmin&#x2F;work&#x2F;require_test&#x2F;FOO.js&#39; ]</span><br><span class="line">---- foo object ----</span><br><span class="line">&#123;</span><br><span class="line">  &quot;foo&quot;: &quot;bar&quot;</span><br><span class="line">&#125;</span><br><span class="line">---- FOO object ----</span><br><span class="line">&#123;</span><br><span class="line">  &quot;foo&quot;: &quot;different bar&quot;</span><br><span class="line">&#125;</span><br><span class="line">---- foo object ----</span><br><span class="line">&#123;</span><br><span class="line">  &quot;foo&quot;: &quot;bar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>결과에서 확인 가능하듯이 require된 모듈은 key값으로 <strong>해당 모듈 파일의 경로</strong>를 사용해 캐싱되고 있습니다. require시 대 / 소문자를 구분해 key로 사용하기 때문에 2개의 객체가 생성되었으나, 결과적으로는 파일 시스템에 도달하면 같은 파일이 2번 반환된 것입니다. 즉, 같은 파일에 서로 다른 모듈로 2개가 생성되어 있는 것 입니다.</p>
<p>require 문에 파일 이름을 잘못 입력 한 것과 관련된 다른 문제도 있습니다. 대 / 소문자를 구분하는 파일 시스템에 배포하는 경우 실제 파일과 동일하게 처리되지 않은 버전은 파일을 찾지 못합니다.</p>
<hr>
<span id="4">
## 4. NPM 모듈 종속성

<p>모듈 캐싱이 제대로 작동하지 않는 상황은 NPM에서 둘 이상의 **<code>모듈 종속성이 같은 모듈을 설치</code>**할 때 입니다. 즉, 프로젝트가 NPM의 “Foo”와 “Bar”에 의존하고 Foo와 Bar가 둘 다 “Baz”에 의존하면 NPM (버전 2 이하)은에 의존하는 각 모듈에 대해 “Baz”의 다른 사본을 설치합니다.</p>
<p><strong><code>NPM 버전 3</code></strong> 에서는 종속성 목록을 병합하여 문제를 해결하고 있습니다. Foo와 Bar가 둘 다 동일한 Baz의 버전에 의존하면 하나의 사본만 설치합니다.</p>
<p>그러나, Foo와 Bar가 Baz의 서로 다른 (서로 호환되지 않는) 버전을 사용한다면, 여전히 두 버전을 모두 설치하며, 이 경우 모듈 캐시를 공유하지 않습니다.</p>
<hr>
<span id="5">
## 5. 마치며

<p>반복되는 코드를 모듈화 하거나 각 기능 별로 모듈화 하게되면 결국 다른 파일에서 require를 통해 사용하게 되는데, 이때마다 어떤식으로 동작하게 되는지 궁금했었습니다. 이번 포스팅을 작성하면서 이에 대한 궁금증을 해결할 수 있었고, 결과적으로 한번 로딩된 모듈은 캐싱되어 사용되기 때문에 각기 파일마다 require를 많이 한다고해서 크게 걱정할 필요는 없을 것 같습니다.</p>
<p>또한, 필요에 의해 (필요한 상황이 있을지 모르겠지만…) require.cache에 고의적으로 캐싱된 모듈을 지우고 다시 새로 로딩하여 사용할 수도 있을것 같습니다.</p>
</span></span></span></span></span></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/Programming/archives/5/">이전</a></div><div class="pagination-next"><a href="/categories/Programming/archives/7/">다음</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/Programming/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/Programming/archives/5/">5</a></li><li><a class="pagination-link is-current" href="/categories/Programming/archives/6/">6</a></li><li><a class="pagination-link" href="/categories/Programming/archives/7/">7</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/Programming/archives/10/">10</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpeg" alt="JongMin"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">JongMin</p><p class="is-size-6 is-block">생각을 기록하자</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">125</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">23</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">205</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/jongmin92" target="_blank" rel="external nofollow noopener noreferrer">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/jongmin92"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Facebook" href="https://www.facebook.com/jongmin.kim.7796420"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">14</span></span></a><ul><li><a class="level is-mobile" href="/categories/Algorithm/BOJ/"><span class="level-start"><span class="level-item">BOJ</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Algorithm/Concept/"><span class="level-start"><span class="level-item">Concept</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Book/"><span class="level-start"><span class="level-item">Book</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">95</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Gradle/"><span class="level-start"><span class="level-item">Gradle</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/HTML/"><span class="level-start"><span class="level-item">HTML</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/JavaScript/"><span class="level-start"><span class="level-item">JavaScript</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Linux-Ubuntu/"><span class="level-start"><span class="level-item">Linux &amp; Ubuntu</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Node/"><span class="level-start"><span class="level-item">Node</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/RaspberryPi/"><span class="level-start"><span class="level-item">RaspberryPi</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/React-Native/"><span class="level-start"><span class="level-item">React Native</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Tool/"><span class="level-start"><span class="level-item">Tool</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Project/"><span class="level-start"><span class="level-item">Project</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/Project/Emily/"><span class="level-start"><span class="level-item">Emily</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Tip/"><span class="level-start"><span class="level-item">Tip</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2021-03-20T15:17:42.000Z">2021-03-21</time></p><p class="title"><a href="/2021/03/21/Kotlin/coroutines/">코루틴 이해하기</a></p><p class="categories"><a href="/categories/Kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2020-03-30T15:44:27.000Z">2020-03-31</time></p><p class="title"><a href="/2020/03/31/Java/use-assertthat/">Unit Test에서 AssertThat을 사용하자</a></p><p class="categories"><a href="/categories/Java/">Java</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2020-01-02T13:29:00.000Z">2020-01-02</time></p><p class="title"><a href="/2020/01/02/Java/rsa/">Encryption - RSA</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Java/">Java</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2019-12-26T13:23:00.000Z">2019-12-26</time></p><p class="title"><a href="/2019/12/26/Programming/2019-retrospect/">2년차 LINE 서버 개발자의 2019년 회고</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2019-12-23T14:37:00.000Z">2019-12-23</time></p><p class="title"><a href="/2019/12/23/Programming/hmac/">HMAC을 이용한 무결성 보장</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3921438651818825" data-ad-slot="3015269677" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="92Hz" height="28"></a><p class="is-size-7"><span>&copy; 2021 KimJongMin</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>